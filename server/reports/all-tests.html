<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:12,&quot;tests&quot;:46,&quot;passes&quot;:37,&quot;pending&quot;:0,&quot;failures&quot;:9,&quot;start&quot;:&quot;2025-07-01T22:58:34.999Z&quot;,&quot;end&quot;:&quot;2025-07-01T22:58:43.059Z&quot;,&quot;duration&quot;:8060,&quot;testsRegistered&quot;:46,&quot;passPercent&quot;:80.43478260869566,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;aaf83681-447f-40c2-951f-a88b0a0d4ea7&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;a99fabe3-80b9-4a41-9b67-aef6fc4e68b4&quot;,&quot;title&quot;:&quot;Auth API&quot;,&quot;fullFile&quot;:&quot;/app/src/tests/integration/auth.test.ts&quot;,&quot;file&quot;:&quot;/src/tests/integration/auth.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Auth API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Auth API \&quot;before all\&quot; hook in \&quot;Auth API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(express_1.default.json());\napp.use(&#x27;/api/auth&#x27;, auth_1.default);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0fbbe568-e1ed-4e98-a92a-b3508b109110&quot;,&quot;parentUUID&quot;:&quot;a99fabe3-80b9-4a41-9b67-aef6fc4e68b4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Auth API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Auth API \&quot;after each\&quot; hook in \&quot;Auth API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e4598db7-b12d-4dbd-b2be-a21bcc565179&quot;,&quot;parentUUID&quot;:&quot;a99fabe3-80b9-4a41-9b67-aef6fc4e68b4&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1b99ce24-83fc-4208-a339-25e01c44b0b7&quot;,&quot;title&quot;:&quot;/api/auth/register POST&quot;,&quot;fullFile&quot;:&quot;/app/src/tests/integration/auth.test.ts&quot;,&quot;file&quot;:&quot;/src/tests/integration/auth.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing name&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for missing name&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:30,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password are required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;246cf39e-3e62-4de2-befa-54731ec613af&quot;,&quot;parentUUID&quot;:&quot;1b99ce24-83fc-4208-a339-25e01c44b0b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for missing email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test name&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password are required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1bc7b6bf-a527-4c74-a30b-cdc904dbd039&quot;,&quot;parentUUID&quot;:&quot;1b99ce24-83fc-4208-a339-25e01c44b0b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing password&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for missing password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password are required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d1217ee3-eb77-4b2e-beb6-70f0c98d2b4b&quot;,&quot;parentUUID&quot;:&quot;1b99ce24-83fc-4208-a339-25e01c44b0b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string name&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for non string name&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: 123,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password need to be strings&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7fd8419d-018a-48ec-b7ca-bca68f2b0f0e&quot;,&quot;parentUUID&quot;:&quot;1b99ce24-83fc-4208-a339-25e01c44b0b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for non string email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test name&#x27;,\n                email: 123,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password need to be strings&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c1eb8855-a564-4d6d-aff8-45ecf897f83a&quot;,&quot;parentUUID&quot;:&quot;1b99ce24-83fc-4208-a339-25e01c44b0b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string password&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for non string password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: 123\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password need to be strings&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8bacd4d1-4609-4e9f-86db-d95d3f8f3e14&quot;,&quot;parentUUID&quot;:&quot;1b99ce24-83fc-4208-a339-25e01c44b0b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failed email validation&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 500 for failed email validation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).throws(new Error(\&quot;Error related to searching user with email\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test user&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to determine validity of email&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;55f0af4c-7809-4e45-a61c-a79aba4c4f87&quot;,&quot;parentUUID&quot;:&quot;1b99ce24-83fc-4208-a339-25e01c44b0b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for existing account&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for existing account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves({\n                _id: &#x27;existing_id&#x27;,\n                name: &#x27;Existing User&#x27;,\n                email: &#x27;existing@example.com&#x27;,\n                password: &#x27;hashed_password&#x27;,\n                isEmailVerified: true\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test user&#x27;,\n                email: &#x27;existing@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Email already exists. Pleast try logging in instead&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8ffbee74-340d-4b0c-83ca-170c4dc876ad&quot;,&quot;parentUUID&quot;:&quot;1b99ce24-83fc-4208-a339-25e01c44b0b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failed register&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 500 for failed register&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(null);\n            sinon_1.default.stub(authService_1.AuthService, &#x27;register&#x27;).throws(new Error(\&quot;Unknown error in register\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test user&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Registration failed. Please try again&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f279b355-e49b-4774-bdad-346963860bd1&quot;,&quot;parentUUID&quot;:&quot;1b99ce24-83fc-4208-a339-25e01c44b0b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 201 on successful register&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 201 on successful register&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeUser = {\n                _id: &#x27;test user id&#x27;,\n                name: &#x27;test user&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                isEmailVerified: true,\n                verificationToken: &#x27;test token&#x27;,\n                verificationTokenExpires: (new Date(Date.now() + 24 * 60 * 60 * 1000)).toISOString(),\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(null);\n            sinon_1.default.stub(authService_1.AuthService, &#x27;register&#x27;).resolves({\n                token: &#x27;123abc&#x27;,\n                user: fakeUser\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test user&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(201);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Registration successful! Your account has been created and verified&#x27;,\n                data: fakeUser,\n                token: &#x27;123abc&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;532790b8-c4a8-4852-bb5c-587c2fae970c&quot;,&quot;parentUUID&quot;:&quot;1b99ce24-83fc-4208-a339-25e01c44b0b7&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;246cf39e-3e62-4de2-befa-54731ec613af&quot;,&quot;1bc7b6bf-a527-4c74-a30b-cdc904dbd039&quot;,&quot;d1217ee3-eb77-4b2e-beb6-70f0c98d2b4b&quot;,&quot;7fd8419d-018a-48ec-b7ca-bca68f2b0f0e&quot;,&quot;c1eb8855-a564-4d6d-aff8-45ecf897f83a&quot;,&quot;8bacd4d1-4609-4e9f-86db-d95d3f8f3e14&quot;,&quot;55f0af4c-7809-4e45-a61c-a79aba4c4f87&quot;,&quot;8ffbee74-340d-4b0c-83ca-170c4dc876ad&quot;,&quot;f279b355-e49b-4774-bdad-346963860bd1&quot;,&quot;532790b8-c4a8-4852-bb5c-587c2fae970c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:58,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;5fdb6d3b-87df-4351-9f61-7a9a1343eaf5&quot;,&quot;title&quot;:&quot;/api/auth/login POST&quot;,&quot;fullFile&quot;:&quot;/app/src/tests/integration/auth.test.ts&quot;,&quot;file&quot;:&quot;/src/tests/integration/auth.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 400 for missing email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                password: &#x27;hashed-password&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Email and password are required\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c1b7b45c-8097-46c8-8f90-a1aacd35b043&quot;,&quot;parentUUID&quot;:&quot;5fdb6d3b-87df-4351-9f61-7a9a1343eaf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing password&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 400 for missing password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: \&quot;test@example.com\&quot;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Email and password are required\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;710b4e6c-5eb8-420f-9425-4f9f29a132ac&quot;,&quot;parentUUID&quot;:&quot;5fdb6d3b-87df-4351-9f61-7a9a1343eaf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 400 for non string email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: 123,\n                password: &#x27;test-hash&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Email and password must be strings\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;221bdef8-8ad5-427a-998c-34b180b9df5f&quot;,&quot;parentUUID&quot;:&quot;5fdb6d3b-87df-4351-9f61-7a9a1343eaf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string password&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 400 for non string password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: 123\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Email and password must be strings\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bf03fea8-5bfb-4569-9f73-8ae5ce8d2bb7&quot;,&quot;parentUUID&quot;:&quot;5fdb6d3b-87df-4351-9f61-7a9a1343eaf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 401 for bad email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 401 for bad email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(null);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;\n            })\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Invalid email or password\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4808b11c-7490-4ed0-91e2-680ab6a754b9&quot;,&quot;parentUUID&quot;:&quot;5fdb6d3b-87df-4351-9f61-7a9a1343eaf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 401 for unverified email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 401 for unverified email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const unverifiedUser = {\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;,\n                isEmailVerified: false\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(unverifiedUser);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;\n            })\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Please verify your email before logging in\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8641c3a0-7200-4a96-ad6a-b0639cb6bc7a&quot;,&quot;parentUUID&quot;:&quot;5fdb6d3b-87df-4351-9f61-7a9a1343eaf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unknown error during login&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 500 for unknown error during login&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const userWithPassword = {\n                _id: &#x27;test_id&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;,\n                isEmailVerified: true\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(userWithPassword);\n            sinon_1.default.stub(authService_1.AuthService, &#x27;login&#x27;).throws(new Error(\&quot;Some error during login\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;\n            })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Unknown authentication error\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;44e57927-2745-4f99-9a4d-942f3cfbf399&quot;,&quot;parentUUID&quot;:&quot;5fdb6d3b-87df-4351-9f61-7a9a1343eaf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 with token and user for successful login&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 200 with token and user for successful login&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const userWithPassword = {\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;hashed-password&#x27;,\n                isEmailVerified: true,\n            };\n            const { password } = userWithPassword, userWithoutPassword = __rest(userWithPassword, [\&quot;password\&quot;]);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(userWithPassword);\n            sinon_1.default.stub(authService_1.AuthService, &#x27;login&#x27;).resolves({\n                token: &#x27;token123&#x27;,\n                user: userWithoutPassword\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;hashed-password&#x27;\n            })\n                .expect(200);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Login successful&#x27;,\n                data: userWithoutPassword,\n                token: &#x27;token123&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;844e889e-2cf9-4e10-9690-fc6afae1d75a&quot;,&quot;parentUUID&quot;:&quot;5fdb6d3b-87df-4351-9f61-7a9a1343eaf5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;c1b7b45c-8097-46c8-8f90-a1aacd35b043&quot;,&quot;710b4e6c-5eb8-420f-9425-4f9f29a132ac&quot;,&quot;221bdef8-8ad5-427a-998c-34b180b9df5f&quot;,&quot;bf03fea8-5bfb-4569-9f73-8ae5ce8d2bb7&quot;,&quot;4808b11c-7490-4ed0-91e2-680ab6a754b9&quot;,&quot;8641c3a0-7200-4a96-ad6a-b0639cb6bc7a&quot;,&quot;44e57927-2745-4f99-9a4d-942f3cfbf399&quot;,&quot;844e889e-2cf9-4e10-9690-fc6afae1d75a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:14,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;184ad60c-a2a3-4bd7-bed5-d7f68dafaed5&quot;,&quot;title&quot;:&quot;Chat API&quot;,&quot;fullFile&quot;:&quot;/app/src/tests/integration/chat.test.ts&quot;,&quot;file&quot;:&quot;/src/tests/integration/chat.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Chat API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Chat API \&quot;before all\&quot; hook in \&quot;Chat API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(express_1.default.json());\napp.use(&#x27;/api/chat&#x27;, chat_1.default);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ec9fd623-40f8-4cf9-b9e9-8bba8e99cdce&quot;,&quot;parentUUID&quot;:&quot;184ad60c-a2a3-4bd7-bed5-d7f68dafaed5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Chat API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Chat API \&quot;after each\&quot; hook in \&quot;Chat API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b5abfb2d-ce34-42d4-a498-9231baad61fd&quot;,&quot;parentUUID&quot;:&quot;184ad60c-a2a3-4bd7-bed5-d7f68dafaed5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;daeda8c9-334b-455a-a2fd-83425c3b21a6&quot;,&quot;title&quot;:&quot;/api/chat POST&quot;,&quot;fullFile&quot;:&quot;/app/src/tests/integration/chat.test.ts&quot;,&quot;file&quot;:&quot;/src/tests/integration/chat.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for missing messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;messages and email required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;66189781-1a18-4da0-8815-a242037f1146&quot;,&quot;parentUUID&quot;:&quot;daeda8c9-334b-455a-a2fd-83425c3b21a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing email&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for missing email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                messages: [\n                    {\n                        speaker: &#x27;user&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first reply&#x27;\n                    }\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;messages and email required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;defb634a-0bf2-4ec2-996d-fd68c4af6af4&quot;,&quot;parentUUID&quot;:&quot;daeda8c9-334b-455a-a2fd-83425c3b21a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string email&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for non string email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: 123,\n                messages: [\n                    {\n                        speaker: &#x27;user&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first reply&#x27;\n                    }\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;email needs to be a string&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b253c453-b827-4ad8-ba41-1807d4f0d0af&quot;,&quot;parentUUID&quot;:&quot;daeda8c9-334b-455a-a2fd-83425c3b21a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non array messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for non array messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: &#x27;filler&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;messages needs to be an array&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;81fbe2d4-1408-4949-a1a9-343a58aa7a67&quot;,&quot;parentUUID&quot;:&quot;daeda8c9-334b-455a-a2fd-83425c3b21a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing text in messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for missing text in messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;user&#x27;,\n                    },\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid speaker or text found on message&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;25db4051-6c9b-4472-968c-880eb04724eb&quot;,&quot;parentUUID&quot;:&quot;daeda8c9-334b-455a-a2fd-83425c3b21a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing speaker in messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for missing speaker in messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        text: &#x27;first reply&#x27;\n                    },\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid speaker or text found on message&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fd4bdf3b-86d6-45e9-980d-ead42ad3b285&quot;,&quot;parentUUID&quot;:&quot;daeda8c9-334b-455a-a2fd-83425c3b21a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for invalid speaker in messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for invalid speaker in messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;NOT A BOT OR A USER&#x27;,\n                        text: &#x27;first reply&#x27;\n                    }\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid speaker or text found on message&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;74af9529-bccc-4966-bf53-04ba9268b3ce&quot;,&quot;parentUUID&quot;:&quot;daeda8c9-334b-455a-a2fd-83425c3b21a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string text in messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for non string text in messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;user&#x27;,\n                        text: 12345\n                    }\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid speaker or text found on message&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;faa8d3de-bf57-47a3-a294-25ba7fdcf79c&quot;,&quot;parentUUID&quot;:&quot;daeda8c9-334b-455a-a2fd-83425c3b21a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failed save chat&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 500 for failed save chat&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(ChatService_1.ChatService, &#x27;saveChat&#x27;).throws(new Error(\&quot;Some error in save chat\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;user&#x27;,\n                        text: &#x27;first reply&#x27;\n                    }\n                ]\n            })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to save chat&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e13ecee7-8067-4ef2-9cd6-4b49c6840012&quot;,&quot;parentUUID&quot;:&quot;daeda8c9-334b-455a-a2fd-83425c3b21a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for working save chat&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 200 for working save chat&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const testDate = new Date(&#x27;2025-06-30T01:14:27.853Z&#x27;).toISOString();\n            const messagesData = [\n                {\n                    speaker: &#x27;bot&#x27;,\n                    text: &#x27;first message&#x27;,\n                    timestamp: testDate\n                },\n                {\n                    speaker: &#x27;user&#x27;,\n                    text: &#x27;first reply&#x27;,\n                    timestamp: testDate\n                }\n            ];\n            const mockChat = {\n                messages: messagesData,\n                email: &#x27;text@example.com&#x27;,\n                createdAt: testDate\n            };\n            sinon_1.default.stub(ChatService_1.ChatService, &#x27;saveChat&#x27;).resolves(mockChat);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: messagesData\n            })\n                .expect(201);\n            (0, chai_1.expect)(response.body).to.deep.equal(mockChat);\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bfdd6abf-82da-4e1c-888d-5150ef5baf13&quot;,&quot;parentUUID&quot;:&quot;daeda8c9-334b-455a-a2fd-83425c3b21a6&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;66189781-1a18-4da0-8815-a242037f1146&quot;,&quot;defb634a-0bf2-4ec2-996d-fd68c4af6af4&quot;,&quot;b253c453-b827-4ad8-ba41-1807d4f0d0af&quot;,&quot;81fbe2d4-1408-4949-a1a9-343a58aa7a67&quot;,&quot;25db4051-6c9b-4472-968c-880eb04724eb&quot;,&quot;fd4bdf3b-86d6-45e9-980d-ead42ad3b285&quot;,&quot;74af9529-bccc-4966-bf53-04ba9268b3ce&quot;,&quot;faa8d3de-bf57-47a3-a294-25ba7fdcf79c&quot;,&quot;e13ecee7-8067-4ef2-9cd6-4b49c6840012&quot;,&quot;bfdd6abf-82da-4e1c-888d-5150ef5baf13&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:13,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c0a3aec9-2842-4594-9ea8-0a7fb84c2c07&quot;,&quot;title&quot;:&quot;Chatbot API&quot;,&quot;fullFile&quot;:&quot;/app/src/tests/integration/chatbot.test.ts&quot;,&quot;file&quot;:&quot;/src/tests/integration/chatbot.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Chatbot API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Chatbot API \&quot;before all\&quot; hook in \&quot;Chatbot API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(express_1.default.json());\napp.post(&#x27;/api/chatbot&#x27;, chatbot_1.postChat);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dddd6268-5f64-4d26-b672-45c3fc623a90&quot;,&quot;parentUUID&quot;:&quot;c0a3aec9-2842-4594-9ea8-0a7fb84c2c07&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Chatbot API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Chatbot API \&quot;after each\&quot; hook in \&quot;Chatbot API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9ad859fc-1b7c-4525-9f25-7fac5ed43929&quot;,&quot;parentUUID&quot;:&quot;c0a3aec9-2842-4594-9ea8-0a7fb84c2c07&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0f6f42ef-bbe4-48d3-8151-28f1ea19db7e&quot;,&quot;title&quot;:&quot;/api/chatbot POST&quot;,&quot;fullFile&quot;:&quot;/app/src/tests/integration/chatbot.test.ts&quot;,&quot;file&quot;:&quot;/src/tests/integration/chatbot.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns 400 code for missing message&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 400 code for missing message&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({})\n                .expect(400);\n            expect(response.body).to.deep.equal({ error: &#x27;Message is required&#x27; });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;88b54d90-7a3a-4465-8f3a-f0bc0154ecba&quot;,&quot;parentUUID&quot;:&quot;0f6f42ef-bbe4-48d3-8151-28f1ea19db7e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 400 code for wrong data type&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 400 code for wrong data type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: 0 })\n                .expect(400);\n            expect(response.body).to.deep.equal({ error: &#x27;Message must be a string&#x27; });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { error: &#x27;Message is required&#x27; } to deeply equal { error: &#x27;Message must be a string&#x27; }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { error: &#x27;Message is required&#x27; } to deeply equal { error: &#x27;Message must be a string&#x27; }\n    at /app/src/tests/integration/chatbot.test.ts:51:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src/tests/integration/chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;error\&quot;: \&quot;Message is required\&quot;\n+   \&quot;error\&quot;: \&quot;Message must be a string\&quot;\n }\n&quot;},&quot;uuid&quot;:&quot;c1da12e6-d4f3-40be-ac2a-80c277513067&quot;,&quot;parentUUID&quot;:&quot;0f6f42ef-bbe4-48d3-8151-28f1ea19db7e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 400 code for empty message&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 400 code for empty message&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;\&quot; })\n                .expect(400);\n            expect(response.body).to.deep.equal({ error: &#x27;Message cannot be empty&#x27; });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { error: &#x27;Message is required&#x27; } to deeply equal { error: &#x27;Message cannot be empty&#x27; }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { error: &#x27;Message is required&#x27; } to deeply equal { error: &#x27;Message cannot be empty&#x27; }\n    at /app/src/tests/integration/chatbot.test.ts:60:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src/tests/integration/chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;error\&quot;: \&quot;Message is required\&quot;\n+   \&quot;error\&quot;: \&quot;Message cannot be empty\&quot;\n }\n&quot;},&quot;uuid&quot;:&quot;8ef3dec7-6609-4669-9098-9a3d1b4df031&quot;,&quot;parentUUID&quot;:&quot;0f6f42ef-bbe4-48d3-8151-28f1ea19db7e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 500 code for failed chatbot API call&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 500 code for failed chatbot API call&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1573,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).throws(new Error(\&quot;some API error message\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;hi\&quot; })\n                .expect(500);\n            expect(response.body).to.deep.equal({ error: &#x27;Unable to call chatbot API&#x27; });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 200 \&quot;OK\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 200 \&quot;OK\&quot;\n    at /app/src/tests/integration/chatbot.test.ts:68:10\n    at Generator.next (&lt;anonymous&gt;)\n    at /app/src/tests/integration/chatbot.test.ts:41:71\n    at new Promise (&lt;anonymous&gt;)\n    at __awaiter (src/tests/integration/chatbot.test.ts:37:12)\n    at Context.&lt;anonymous&gt; (src/tests/integration/chatbot.test.ts:63:67)\n    at processImmediate (node:internal/timers:485:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /app/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:518:28)\n    at Server.emit (node:domain:489:12)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)&quot;},&quot;uuid&quot;:&quot;1f810653-580a-4a34-baff-526e2c76be2c&quot;,&quot;parentUUID&quot;:&quot;0f6f42ef-bbe4-48d3-8151-28f1ea19db7e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 500 code for incomplete chatbot response&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 500 code for incomplete chatbot response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1367,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).resolves({\n                chatbotMessage: \&quot;\&quot;,\n                productRequested: false,\n                productQuery: \&quot;\&quot;\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;give me an incomplete response\&quot; })\n                .expect(500);\n            expect(response.body).to.deep.equal({ error: &#x27;AI unable to respond&#x27; });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 200 \&quot;OK\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 200 \&quot;OK\&quot;\n    at /app/src/tests/integration/chatbot.test.ts:83:10\n    at Generator.next (&lt;anonymous&gt;)\n    at /app/src/tests/integration/chatbot.test.ts:41:71\n    at new Promise (&lt;anonymous&gt;)\n    at __awaiter (src/tests/integration/chatbot.test.ts:37:12)\n    at Context.&lt;anonymous&gt; (src/tests/integration/chatbot.test.ts:73:71)\n    at processImmediate (node:internal/timers:485:21)\n----\n    at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)\n    at /app/node_modules/supertest/lib/test.js:323:13\n    at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)\n    at Test.assert (node_modules/supertest/lib/test.js:179:23)\n    at Server.localAssert (node_modules/supertest/lib/test.js:135:14)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:518:28)\n    at Server.emit (node:domain:489:12)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)&quot;},&quot;uuid&quot;:&quot;18c31ad4-ddee-476f-8a49-388c7bbdb619&quot;,&quot;parentUUID&quot;:&quot;0f6f42ef-bbe4-48d3-8151-28f1ea19db7e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 200 code for working chatbot API without products&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 200 code for working chatbot API without products&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1435,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).resolves({\n                chatbotMessage: \&quot;What would you like to search for?\&quot;,\n                productRequested: false,\n                productQuery: \&quot;\&quot;\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;test message\&quot; })\n                .expect(200);\n            expect(response.body).to.deep.equal({\n                chatbotMessage: \&quot;What would you like to search for?\&quot;,\n                productData: null\n            });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { (2) } to deeply equal { (2) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { (2) } to deeply equal { (2) }\n    at /app/src/tests/integration/chatbot.test.ts:99:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src/tests/integration/chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;chatbotMessage\&quot;: \&quot;I&#x27;m BuyWise, your shopping assistant for laptops, phones, and computers. I can help you find the perfect tech products, compare prices, and get recommendations. What device are you looking for?\&quot;\n+   \&quot;chatbotMessage\&quot;: \&quot;What would you like to search for?\&quot;\n   \&quot;productData\&quot;: [null]\n }\n&quot;},&quot;uuid&quot;:&quot;6e15e77f-47ad-4bd4-8a58-d5c36c695736&quot;,&quot;parentUUID&quot;:&quot;0f6f42ef-bbe4-48d3-8151-28f1ea19db7e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 200 code for working chatbot API and failed product API&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 200 code for working chatbot API and failed product API&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1227,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).resolves({\n                chatbotMessage: \&quot;Here are some macbooks I found.\&quot;,\n                productRequested: true,\n                productQuery: \&quot;macbook\&quot;\n            });\n            sinon_1.default.stub(ProductService_1.ProductService, &#x27;searchProducts&#x27;).throws(new Error(\&quot;some API error message\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;I want some macbooks\&quot; })\n                .expect(200);\n            expect(response.body).to.deep.equal({\n                chatbotMessage: \&quot;Here are some macbooks I found.\&quot;,\n                productData: []\n            });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { (2) } to deeply equal { (2) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { (2) } to deeply equal { (2) }\n    at /app/src/tests/integration/chatbot.test.ts:118:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src/tests/integration/chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;chatbotMessage\&quot;: \&quot;I found some MacBook options for you! Would you like to see the latest models, or do you have a specific budget or use case in mind? Let me know so I can help you find the perfect MacBook!\&quot;\n-   \&quot;productData\&quot;: [null]\n+   \&quot;chatbotMessage\&quot;: \&quot;Here are some macbooks I found.\&quot;\n+   \&quot;productData\&quot;: []\n }\n&quot;},&quot;uuid&quot;:&quot;bf9daa75-ae7d-4058-b2ac-f35f110f1584&quot;,&quot;parentUUID&quot;:&quot;0f6f42ef-bbe4-48d3-8151-28f1ea19db7e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 200 code for working chatbot API and product API&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 200 code for working chatbot API and product API&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1334,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const mockProduct = {\n                product_id: \&quot;123\&quot;,\n                source: \&quot;Best Buy\&quot;,\n                title: \&quot;MacBook Pro\&quot;,\n                thumbnail: \&quot;image.jpg\&quot;,\n                extracted_price: 1299,\n                seller_details: { direct_link: \&quot;http://example.com\&quot; },\n                rating: 4.5,\n                reviews: 120\n            };\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).resolves({\n                chatbotMessage: \&quot;Here are some macbooks I found.\&quot;,\n                productRequested: true,\n                productQuery: \&quot;macbook\&quot;\n            });\n            sinon_1.default.stub(ProductService_1.ProductService, &#x27;searchProducts&#x27;).resolves([mockProduct]);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;I want some macbooks\&quot; })\n                .expect(200);\n            expect(response.body).to.deep.equal({\n                chatbotMessage: \&quot;Here are some macbooks I found.\&quot;,\n                productData: [{\n                        id: mockProduct.product_id,\n                        source: mockProduct.source,\n                        title: mockProduct.title,\n                        image: mockProduct.thumbnail,\n                        price: mockProduct.extracted_price,\n                        url: mockProduct.seller_details.direct_link,\n                        rating: mockProduct.rating,\n                        reviews: mockProduct.reviews\n                    }]\n            });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { (2) } to deeply equal { (2) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { (2) } to deeply equal { (2) }\n    at /app/src/tests/integration/chatbot.test.ts:147:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src/tests/integration/chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;chatbotMessage\&quot;: \&quot;I found a MacBook Pro available for $1299 at Best Buy. Would you like more options or details about this model?\&quot;\n+   \&quot;chatbotMessage\&quot;: \&quot;Here are some macbooks I found.\&quot;\n   \&quot;productData\&quot;: [\n     {\n       \&quot;id\&quot;: \&quot;123\&quot;\n       \&quot;image\&quot;: \&quot;image.jpg\&quot;\n&quot;},&quot;uuid&quot;:&quot;3503dc64-5faa-44f3-a2bc-75846124081d&quot;,&quot;parentUUID&quot;:&quot;0f6f42ef-bbe4-48d3-8151-28f1ea19db7e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;88b54d90-7a3a-4465-8f3a-f0bc0154ecba&quot;],&quot;failures&quot;:[&quot;c1da12e6-d4f3-40be-ac2a-80c277513067&quot;,&quot;8ef3dec7-6609-4669-9098-9a3d1b4df031&quot;,&quot;1f810653-580a-4a34-baff-526e2c76be2c&quot;,&quot;18c31ad4-ddee-476f-8a49-388c7bbdb619&quot;,&quot;6e15e77f-47ad-4bd4-8a58-d5c36c695736&quot;,&quot;bf9daa75-ae7d-4058-b2ac-f35f110f1584&quot;,&quot;3503dc64-5faa-44f3-a2bc-75846124081d&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:6942,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0e9776f2-92f3-4faa-bced-29562f56b6ac&quot;,&quot;title&quot;:&quot;Products API&quot;,&quot;fullFile&quot;:&quot;/app/src/tests/integration/products.test.ts&quot;,&quot;file&quot;:&quot;/src/tests/integration/products.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Products API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Products API \&quot;before all\&quot; hook in \&quot;Products API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(&#x27;/api/products&#x27;, products_1.default);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f1006e98-d91e-46f6-93a4-3a1efb6243e9&quot;,&quot;parentUUID&quot;:&quot;0e9776f2-92f3-4faa-bced-29562f56b6ac&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Products API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Products API \&quot;after each\&quot; hook in \&quot;Products API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;42e380ad-5b21-443f-a6b2-8efb93df119a&quot;,&quot;parentUUID&quot;:&quot;0e9776f2-92f3-4faa-bced-29562f56b6ac&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8a7a3dab-bfef-42e9-8d84-e011bd5a9bd5&quot;,&quot;title&quot;:&quot;GET /api/products/search&quot;,&quot;fullFile&quot;:&quot;/app/src/tests/integration/products.test.ts&quot;,&quot;file&quot;:&quot;/src/tests/integration/products.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return products for a valid search query&quot;,&quot;fullTitle&quot;:&quot;Products API GET /api/products/search should return products for a valid search query&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeProducts = [\n                {\n                    category: &#x27;Popular products&#x27;,\n                    thumbnail: &#x27;https://example.com/image.jpg&#x27;,\n                    source_logo: &#x27;https://example.com/logo.png&#x27;,\n                    source: &#x27;Best Buy&#x27;,\n                    title: &#x27;HP 14\&quot; Intel Celeron Laptop&#x27;,\n                    rating: 4.2,\n                    reviews: 148,\n                    price: &#x27;$199.99&#x27;,\n                    extracted_price: 199.99,\n                    location: &#x27;Nearby, 13 mi&#x27;,\n                    product_id: &#x27;2197135960910078338&#x27;,\n                    seller_details: [\n                        {\n                            position: 1,\n                            name: &#x27;Best Buy&#x27;,\n                            top_quality_store: true,\n                            payment_methods: &#x27;PayPal, Zip accepted&#x27;,\n                            rating: 4.6,\n                            reviews: 532,\n                            reviews_original: &#x27;(532)&#x27;,\n                            link: &#x27;https://google.com/redirect&#x27;,\n                            direct_link: &#x27;https://bestbuy.com/product&#x27;,\n                            details_and_offers: [{ text: &#x27;5.3 mi  In stock at GainesvilleToday: 10:00 AM - 8:00 PM&#x27; }],\n                            base_price: &#x27;$199.99&#x27;,\n                            additional_price: { shipping: &#x27;See website&#x27; },\n                            total_price: &#x27;$199.99&#x27;,\n                        }\n                    ],\n                },\n            ];\n            sinon_1.default.stub(ProductService_1.ProductService, &#x27;searchProducts&#x27;).resolves(fakeProducts);\n            const res = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/products/search&#x27;)\n                .query({ q: &#x27;Laptop under $400&#x27;, device: &#x27;desktop&#x27;, location: &#x27;Canada&#x27; });\n            (0, chai_1.expect)(res.status).to.equal(200);\n            (0, chai_1.expect)(res.body.success).to.be.true;\n            (0, chai_1.expect)(res.body.products).to.deep.equal(fakeProducts);\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4138ac6c-e760-4c87-b915-fdf8f2f0b0e8&quot;,&quot;parentUUID&quot;:&quot;8a7a3dab-bfef-42e9-8d84-e011bd5a9bd5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the search query is missing&quot;,&quot;fullTitle&quot;:&quot;Products API GET /api/products/search should return 400 if the search query is missing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const res = yield (0, supertest_1.default)(app).get(&#x27;/api/products/search&#x27;);\n            (0, chai_1.expect)(res.status).to.equal(400);\n            (0, chai_1.expect)(res.body.success).to.be.false;\n            (0, chai_1.expect)(res.body.error).to.equal(&#x27;Search query is required&#x27;);\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;23586b4a-6d8e-4f4c-afc8-c767f0ffda74&quot;,&quot;parentUUID&quot;:&quot;8a7a3dab-bfef-42e9-8d84-e011bd5a9bd5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 if the ProductService throws an error&quot;,&quot;fullTitle&quot;:&quot;Products API GET /api/products/search should return 500 if the ProductService throws an error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(ProductService_1.ProductService, &#x27;searchProducts&#x27;).throws(new Error(&#x27;SerpAPI error&#x27;));\n            const res = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/products/search&#x27;)\n                .query({ q: &#x27;Laptop&#x27; });\n            (0, chai_1.expect)(res.status).to.equal(500);\n            (0, chai_1.expect)(res.body.success).to.be.false;\n            (0, chai_1.expect)(res.body.error).to.equal(&#x27;SerpAPI error&#x27;);\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2d54a63f-0be9-449f-b150-3ec751b6d5ac&quot;,&quot;parentUUID&quot;:&quot;8a7a3dab-bfef-42e9-8d84-e011bd5a9bd5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4138ac6c-e760-4c87-b915-fdf8f2f0b0e8&quot;,&quot;23586b4a-6d8e-4f4c-afc8-c767f0ffda74&quot;,&quot;2d54a63f-0be9-449f-b150-3ec751b6d5ac&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:10,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f9951435-1988-482c-8ed8-c56c1237c358&quot;,&quot;title&quot;:&quot;Profile API&quot;,&quot;fullFile&quot;:&quot;/app/src/tests/integration/profile.test.ts&quot;,&quot;file&quot;:&quot;/src/tests/integration/profile.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Profile API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Profile API \&quot;before all\&quot; hook in \&quot;Profile API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(express_1.default.json());\napp.use(&#x27;/api/profiles&#x27;, profile_1.default);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aa93387c-3c82-4808-a0ed-85dd2bc22bca&quot;,&quot;parentUUID&quot;:&quot;f9951435-1988-482c-8ed8-c56c1237c358&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Profile API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Profile API \&quot;after each\&quot; hook in \&quot;Profile API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;946d9090-5e5f-469c-b2dd-676e68c6a5b6&quot;,&quot;parentUUID&quot;:&quot;f9951435-1988-482c-8ed8-c56c1237c358&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c643ed9a-02a6-493c-9324-144078cbfe65&quot;,&quot;title&quot;:&quot;/api/profiles/verify/:token GET&quot;,&quot;fullFile&quot;:&quot;/app/src/tests/integration/profile.test.ts&quot;,&quot;file&quot;:&quot;/src/tests/integration/profile.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing token&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 400 for missing token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify&#x27;)\n                .query({})\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;token missing from params&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7ee4bbf0-b107-4547-9b50-c7e9f82cd2a1&quot;,&quot;parentUUID&quot;:&quot;c643ed9a-02a6-493c-9324-144078cbfe65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failing to get user&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 500 for failing to get user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByToken&#x27;).throws(new Error(\&quot;Some error related to getting user\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify/test123&#x27;)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to get user&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bbe1da67-382d-47ca-bdca-a73747546086&quot;,&quot;parentUUID&quot;:&quot;c643ed9a-02a6-493c-9324-144078cbfe65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 404 for not finding valid user&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 404 for not finding valid user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByToken&#x27;).resolves(null);\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify/test123&#x27;)\n                .expect(404);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid or expired verification token&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5b742935-d35e-4ceb-ba1d-ad71077f3dce&quot;,&quot;parentUUID&quot;:&quot;c643ed9a-02a6-493c-9324-144078cbfe65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failing to verify email&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 500 for failing to verify email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeDate = new Date();\n            const fakeUser = {\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                isEmailVerified: true,\n                verificationToken: &#x27;test123&#x27;,\n                verificationTokenExpires: fakeDate,\n                createdAt: fakeDate,\n                updatedAt: fakeDate,\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByToken&#x27;).resolves(fakeUser);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;verifyEmail&#x27;).throws(new Error(\&quot;Some error related to verifying email\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify/test123&#x27;)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to verify email&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;08cdfa1d-9904-409e-8b25-51e0acf6caac&quot;,&quot;parentUUID&quot;:&quot;c643ed9a-02a6-493c-9324-144078cbfe65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failing to verify email&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 500 for failing to verify email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeDate = new Date();\n            const fakeUser = {\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                isEmailVerified: true,\n                verificationToken: &#x27;test123&#x27;,\n                verificationTokenExpires: fakeDate,\n                createdAt: fakeDate,\n                updatedAt: fakeDate,\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByToken&#x27;).resolves(fakeUser);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;verifyEmail&#x27;).resolves();\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify/test123&#x27;)\n                .expect(200);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Email verified successfully&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;57a4fb2a-78cd-494b-b6dc-dd9cfedd892c&quot;,&quot;parentUUID&quot;:&quot;c643ed9a-02a6-493c-9324-144078cbfe65&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;7ee4bbf0-b107-4547-9b50-c7e9f82cd2a1&quot;,&quot;bbe1da67-382d-47ca-bdca-a73747546086&quot;,&quot;5b742935-d35e-4ceb-ba1d-ad71077f3dce&quot;,&quot;08cdfa1d-9904-409e-8b25-51e0acf6caac&quot;,&quot;57a4fb2a-78cd-494b-b6dc-dd9cfedd892c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:8,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;16acefdd-d2a3-48a5-a724-2c72f9787b5c&quot;,&quot;title&quot;:&quot;EmailService&quot;,&quot;fullFile&quot;:&quot;/app/src/tests/unit/EmailService.test.ts&quot;,&quot;file&quot;:&quot;/src/tests/unit/EmailService.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;EmailService\&quot;&quot;,&quot;fullTitle&quot;:&quot;EmailService \&quot;before each\&quot; hook in \&quot;EmailService\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sendMailStub = sinon_1.default.stub().resolves();\ncreateTransportStub = sinon_1.default.stub(nodemailer_1.default, &#x27;createTransport&#x27;).returns({\n    sendMail: sendMailStub\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e9b16a8e-42a7-4e38-9a3e-2264848ac014&quot;,&quot;parentUUID&quot;:&quot;16acefdd-d2a3-48a5-a724-2c72f9787b5c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;EmailService\&quot;&quot;,&quot;fullTitle&quot;:&quot;EmailService \&quot;after each\&quot; hook in \&quot;EmailService\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;90c66bdd-fb0b-484d-a7ec-261d0598761b&quot;,&quot;parentUUID&quot;:&quot;16acefdd-d2a3-48a5-a724-2c72f9787b5c&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send email with correct options&quot;,&quot;fullTitle&quot;:&quot;EmailService should send email with correct options&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:581,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        const email = &#x27;test@example.com&#x27;;\n        const token = &#x27;dummy-token&#x27;;\n        process.env.FRONTEND_URL = &#x27;http://localhost:3000&#x27;;\n        process.env.EMAIL_USER = &#x27;testuser@gmail.com&#x27;;\n        yield emailService.sendVerificationEmail(email, token);\n        (0, chai_1.expect)(sendMailStub.calledOnce).to.be.true;\n        const mailOptions = sendMailStub.firstCall.args[0];\n        (0, chai_1.expect)(mailOptions.to).to.equal(email);\n        (0, chai_1.expect)(mailOptions.from).to.equal(process.env.EMAIL_USER);\n        (0, chai_1.expect)(mailOptions.subject).to.include(&#x27;Verify your BuyWise account&#x27;);\n        (0, chai_1.expect)(mailOptions.html).to.include(`${process.env.FRONTEND_URL}/verify-email?token=${token}`);\n    })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected false to be true&quot;,&quot;estack&quot;:&quot;AssertionError: expected false to be true\n    at /app/src/tests/unit/EmailService.test.ts:31:42\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src/tests/unit/EmailService.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot;- false\n+ true\n&quot;},&quot;uuid&quot;:&quot;9c372311-4031-4c99-afd2-ffc993e69efd&quot;,&quot;parentUUID&quot;:&quot;16acefdd-d2a3-48a5-a724-2c72f9787b5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should throw an error when sending email fails&quot;,&quot;fullTitle&quot;:&quot;EmailService should throw an error when sending email fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:405,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        sendMailStub.rejects(new Error(&#x27;SMTP error&#x27;));\n        try {\n            yield emailService.sendVerificationEmail(&#x27;fail@example.com&#x27;, &#x27;token&#x27;);\n            throw new Error(&#x27;Expected method to throw.&#x27;);\n        }\n        catch (err) {\n            (0, chai_1.expect)(err.message).to.equal(&#x27;Failed to send verification email&#x27;);\n        }\n    })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Expected method to throw.&#x27; to equal &#x27;Failed to send verification email&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Expected method to throw.&#x27; to equal &#x27;Failed to send verification email&#x27;\n    at /app/src/tests/unit/EmailService.test.ts:47:30\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src/tests/unit/EmailService.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot;- Expected method to throw.\n+ Failed to send verification email\n&quot;},&quot;uuid&quot;:&quot;c3448d69-0ede-4449-b903-a64b75fec1ca&quot;,&quot;parentUUID&quot;:&quot;16acefdd-d2a3-48a5-a724-2c72f9787b5c&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;9c372311-4031-4c99-afd2-ffc993e69efd&quot;,&quot;c3448d69-0ede-4449-b903-a64b75fec1ca&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:986,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:20000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;11.7.0&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;all-tests&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportFilename&quot;:&quot;all-tests&quot;},&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;all-tests&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;app&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report/assets&quot;,&quot;jsonFile&quot;:&quot;/app/mochawesome-report/all-tests.json&quot;,&quot;htmlFile&quot;:&quot;/app/mochawesome-report/all-tests.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>