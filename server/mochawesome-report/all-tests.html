<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:12,&quot;tests&quot;:46,&quot;passes&quot;:37,&quot;pending&quot;:0,&quot;failures&quot;:9,&quot;start&quot;:&quot;2025-07-02T01:22:44.263Z&quot;,&quot;end&quot;:&quot;2025-07-02T01:22:53.242Z&quot;,&quot;duration&quot;:8979,&quot;testsRegistered&quot;:46,&quot;passPercent&quot;:80.43478260869566,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;b0ae9f50-1644-40f3-b39b-23e8d90af955&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8a64093d-d976-4a80-a678-a27e06077697&quot;,&quot;title&quot;:&quot;Auth API&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\auth.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\auth.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Auth API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Auth API \&quot;before all\&quot; hook in \&quot;Auth API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(express_1.default.json());\napp.use(&#x27;/api/auth&#x27;, auth_1.default);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b5b3e704-54f4-47f1-b696-a5bd467203d9&quot;,&quot;parentUUID&quot;:&quot;8a64093d-d976-4a80-a678-a27e06077697&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Auth API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Auth API \&quot;after each\&quot; hook in \&quot;Auth API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;99a73fef-fd48-4897-ab76-68214f6eb283&quot;,&quot;parentUUID&quot;:&quot;8a64093d-d976-4a80-a678-a27e06077697&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c18c005b-f43e-4cba-99a3-3cc8e6bbd4d1&quot;,&quot;title&quot;:&quot;/api/auth/register POST&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\auth.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\auth.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing name&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for missing name&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:45,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password are required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;822894fe-e337-4788-a41c-bd8226d19282&quot;,&quot;parentUUID&quot;:&quot;c18c005b-f43e-4cba-99a3-3cc8e6bbd4d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for missing email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test name&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password are required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;66391c9a-becb-4ba4-b332-bbce50a49c29&quot;,&quot;parentUUID&quot;:&quot;c18c005b-f43e-4cba-99a3-3cc8e6bbd4d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing password&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for missing password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password are required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4fb51ed5-10cf-4fd8-8cfd-1a33449e83bd&quot;,&quot;parentUUID&quot;:&quot;c18c005b-f43e-4cba-99a3-3cc8e6bbd4d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string name&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for non string name&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: 123,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password need to be strings&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e791eff7-e923-4027-9f30-e490d7856729&quot;,&quot;parentUUID&quot;:&quot;c18c005b-f43e-4cba-99a3-3cc8e6bbd4d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for non string email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test name&#x27;,\n                email: 123,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password need to be strings&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b50d15e8-79f1-459a-b044-0b1676730000&quot;,&quot;parentUUID&quot;:&quot;c18c005b-f43e-4cba-99a3-3cc8e6bbd4d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string password&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for non string password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: 123\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password need to be strings&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;15267d43-dcea-423a-adae-5812498b65f5&quot;,&quot;parentUUID&quot;:&quot;c18c005b-f43e-4cba-99a3-3cc8e6bbd4d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failed email validation&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 500 for failed email validation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).throws(new Error(\&quot;Error related to searching user with email\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test user&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to determine validity of email&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b4c1aa91-07f1-4598-a71d-db563b790967&quot;,&quot;parentUUID&quot;:&quot;c18c005b-f43e-4cba-99a3-3cc8e6bbd4d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for existing account&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for existing account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves({\n                _id: &#x27;existing_id&#x27;,\n                name: &#x27;Existing User&#x27;,\n                email: &#x27;existing@example.com&#x27;,\n                password: &#x27;hashed_password&#x27;,\n                isEmailVerified: true\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test user&#x27;,\n                email: &#x27;existing@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Email already exists. Pleast try logging in instead&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;19e59c96-4c0d-4a82-8df1-0f6cf5db4f16&quot;,&quot;parentUUID&quot;:&quot;c18c005b-f43e-4cba-99a3-3cc8e6bbd4d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failed register&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 500 for failed register&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(null);\n            sinon_1.default.stub(authService_1.AuthService, &#x27;register&#x27;).throws(new Error(\&quot;Unknown error in register\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test user&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Registration failed. Please try again&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7c4ebca6-3665-449a-94a3-a840062fe680&quot;,&quot;parentUUID&quot;:&quot;c18c005b-f43e-4cba-99a3-3cc8e6bbd4d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 201 on successful register&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 201 on successful register&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeUser = {\n                _id: &#x27;test user id&#x27;,\n                name: &#x27;test user&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                isEmailVerified: true,\n                verificationToken: &#x27;test token&#x27;,\n                verificationTokenExpires: (new Date(Date.now() + 24 * 60 * 60 * 1000)).toISOString(),\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(null);\n            sinon_1.default.stub(authService_1.AuthService, &#x27;register&#x27;).resolves({\n                token: &#x27;123abc&#x27;,\n                user: fakeUser\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test user&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(201);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Registration successful! Your account has been created and verified&#x27;,\n                data: fakeUser,\n                token: &#x27;123abc&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1cdfe636-80d7-4160-b87f-fe6a1a90d090&quot;,&quot;parentUUID&quot;:&quot;c18c005b-f43e-4cba-99a3-3cc8e6bbd4d1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;822894fe-e337-4788-a41c-bd8226d19282&quot;,&quot;66391c9a-becb-4ba4-b332-bbce50a49c29&quot;,&quot;4fb51ed5-10cf-4fd8-8cfd-1a33449e83bd&quot;,&quot;e791eff7-e923-4027-9f30-e490d7856729&quot;,&quot;b50d15e8-79f1-459a-b044-0b1676730000&quot;,&quot;15267d43-dcea-423a-adae-5812498b65f5&quot;,&quot;b4c1aa91-07f1-4598-a71d-db563b790967&quot;,&quot;19e59c96-4c0d-4a82-8df1-0f6cf5db4f16&quot;,&quot;7c4ebca6-3665-449a-94a3-a840062fe680&quot;,&quot;1cdfe636-80d7-4160-b87f-fe6a1a90d090&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:113,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;9b8c8a20-c8c9-4a08-b7a5-7ce8828f7370&quot;,&quot;title&quot;:&quot;/api/auth/login POST&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\auth.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\auth.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 400 for missing email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                password: &#x27;hashed-password&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Email and password are required\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f5ea37fa-2470-4f09-bc8d-2023169d5ee7&quot;,&quot;parentUUID&quot;:&quot;9b8c8a20-c8c9-4a08-b7a5-7ce8828f7370&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing password&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 400 for missing password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: \&quot;test@example.com\&quot;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Email and password are required\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6db6d7de-bb09-4f80-a4c6-3a5e8253bde3&quot;,&quot;parentUUID&quot;:&quot;9b8c8a20-c8c9-4a08-b7a5-7ce8828f7370&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 400 for non string email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: 123,\n                password: &#x27;test-hash&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Email and password must be strings\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;80b4066c-501b-4d9d-8606-ca1d22ce55e7&quot;,&quot;parentUUID&quot;:&quot;9b8c8a20-c8c9-4a08-b7a5-7ce8828f7370&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string password&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 400 for non string password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: 123\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Email and password must be strings\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9a63e158-a9ab-4273-965e-f7f4bd2de028&quot;,&quot;parentUUID&quot;:&quot;9b8c8a20-c8c9-4a08-b7a5-7ce8828f7370&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 401 for bad email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 401 for bad email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(null);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;\n            })\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Invalid email or password\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d75c3084-4da9-4efe-a956-38bfd4c9ed92&quot;,&quot;parentUUID&quot;:&quot;9b8c8a20-c8c9-4a08-b7a5-7ce8828f7370&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 401 for unverified email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 401 for unverified email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const unverifiedUser = {\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;,\n                isEmailVerified: false\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(unverifiedUser);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;\n            })\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Please verify your email before logging in\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;115f8c1b-afde-4326-93e0-e74efb93c44f&quot;,&quot;parentUUID&quot;:&quot;9b8c8a20-c8c9-4a08-b7a5-7ce8828f7370&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unknown error during login&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 500 for unknown error during login&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const userWithPassword = {\n                _id: &#x27;test_id&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;,\n                isEmailVerified: true\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(userWithPassword);\n            sinon_1.default.stub(authService_1.AuthService, &#x27;login&#x27;).throws(new Error(\&quot;Some error during login\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;\n            })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Unknown authentication error\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d768bc9f-a0d2-4a1d-8eec-729ea3e17af6&quot;,&quot;parentUUID&quot;:&quot;9b8c8a20-c8c9-4a08-b7a5-7ce8828f7370&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 with token and user for successful login&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 200 with token and user for successful login&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const userWithPassword = {\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;hashed-password&#x27;,\n                isEmailVerified: true,\n            };\n            const { password } = userWithPassword, userWithoutPassword = __rest(userWithPassword, [\&quot;password\&quot;]);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(userWithPassword);\n            sinon_1.default.stub(authService_1.AuthService, &#x27;login&#x27;).resolves({\n                token: &#x27;token123&#x27;,\n                user: userWithoutPassword\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;hashed-password&#x27;\n            })\n                .expect(200);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Login successful&#x27;,\n                data: userWithoutPassword,\n                token: &#x27;token123&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4fe19393-4d39-4eb6-ac65-362c7c89038c&quot;,&quot;parentUUID&quot;:&quot;9b8c8a20-c8c9-4a08-b7a5-7ce8828f7370&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f5ea37fa-2470-4f09-bc8d-2023169d5ee7&quot;,&quot;6db6d7de-bb09-4f80-a4c6-3a5e8253bde3&quot;,&quot;80b4066c-501b-4d9d-8606-ca1d22ce55e7&quot;,&quot;9a63e158-a9ab-4273-965e-f7f4bd2de028&quot;,&quot;d75c3084-4da9-4efe-a956-38bfd4c9ed92&quot;,&quot;115f8c1b-afde-4326-93e0-e74efb93c44f&quot;,&quot;d768bc9f-a0d2-4a1d-8eec-729ea3e17af6&quot;,&quot;4fe19393-4d39-4eb6-ac65-362c7c89038c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:45,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;49f343db-07ff-42cf-be5a-c125a9defec2&quot;,&quot;title&quot;:&quot;Chat API&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chat.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\chat.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Chat API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Chat API \&quot;before all\&quot; hook in \&quot;Chat API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(express_1.default.json());\napp.use(&#x27;/api/chat&#x27;, chat_1.default);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c27b0a8e-e4dd-46d4-a19e-ed8a4384ac3f&quot;,&quot;parentUUID&quot;:&quot;49f343db-07ff-42cf-be5a-c125a9defec2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Chat API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Chat API \&quot;after each\&quot; hook in \&quot;Chat API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dc9cd72e-7c7f-4fb0-99e2-aae5d47d34fd&quot;,&quot;parentUUID&quot;:&quot;49f343db-07ff-42cf-be5a-c125a9defec2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;cd539c05-ecc3-4a77-9d4f-6b0e7464e980&quot;,&quot;title&quot;:&quot;/api/chat POST&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chat.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\chat.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for missing messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;messages and email required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5ec5eacb-b2e0-4980-8356-b20380a95fa6&quot;,&quot;parentUUID&quot;:&quot;cd539c05-ecc3-4a77-9d4f-6b0e7464e980&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing email&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for missing email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                messages: [\n                    {\n                        speaker: &#x27;user&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first reply&#x27;\n                    }\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;messages and email required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0a4137eb-9fe3-49b2-8f30-6b9481271d84&quot;,&quot;parentUUID&quot;:&quot;cd539c05-ecc3-4a77-9d4f-6b0e7464e980&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string email&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for non string email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: 123,\n                messages: [\n                    {\n                        speaker: &#x27;user&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first reply&#x27;\n                    }\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;email needs to be a string&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2bcd552c-1903-4d38-b018-bfa7149f4b1c&quot;,&quot;parentUUID&quot;:&quot;cd539c05-ecc3-4a77-9d4f-6b0e7464e980&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non array messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for non array messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: &#x27;filler&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;messages needs to be an array&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;196d6bea-1d1f-46e4-87b5-1484b5b08c53&quot;,&quot;parentUUID&quot;:&quot;cd539c05-ecc3-4a77-9d4f-6b0e7464e980&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing text in messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for missing text in messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;user&#x27;,\n                    },\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid speaker or text found on message&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7cde0371-6c55-4b7e-8683-be539f4a325f&quot;,&quot;parentUUID&quot;:&quot;cd539c05-ecc3-4a77-9d4f-6b0e7464e980&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing speaker in messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for missing speaker in messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        text: &#x27;first reply&#x27;\n                    },\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid speaker or text found on message&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;925f39e9-7dce-42c7-9f24-3e1c7a098424&quot;,&quot;parentUUID&quot;:&quot;cd539c05-ecc3-4a77-9d4f-6b0e7464e980&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for invalid speaker in messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for invalid speaker in messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;NOT A BOT OR A USER&#x27;,\n                        text: &#x27;first reply&#x27;\n                    }\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid speaker or text found on message&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8110008a-a593-4e23-aaa5-23c019b3300d&quot;,&quot;parentUUID&quot;:&quot;cd539c05-ecc3-4a77-9d4f-6b0e7464e980&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string text in messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 400 for non string text in messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;user&#x27;,\n                        text: 12345\n                    }\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid speaker or text found on message&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;22dcb328-d6f2-4800-937b-14b060139890&quot;,&quot;parentUUID&quot;:&quot;cd539c05-ecc3-4a77-9d4f-6b0e7464e980&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failed save chat&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 500 for failed save chat&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(ChatService_1.ChatService, &#x27;saveChat&#x27;).throws(new Error(\&quot;Some error in save chat\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;user&#x27;,\n                        text: &#x27;first reply&#x27;\n                    }\n                ]\n            })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to save chat&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f9d77738-0d61-4e5c-a6cd-86f062484294&quot;,&quot;parentUUID&quot;:&quot;cd539c05-ecc3-4a77-9d4f-6b0e7464e980&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for working save chat&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chat POST should return 200 for working save chat&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const testDate = new Date(&#x27;2025-06-30T01:14:27.853Z&#x27;).toISOString();\n            const messagesData = [\n                {\n                    speaker: &#x27;bot&#x27;,\n                    text: &#x27;first message&#x27;,\n                    timestamp: testDate\n                },\n                {\n                    speaker: &#x27;user&#x27;,\n                    text: &#x27;first reply&#x27;,\n                    timestamp: testDate\n                }\n            ];\n            const mockChat = {\n                messages: messagesData,\n                email: &#x27;text@example.com&#x27;,\n                createdAt: testDate\n            };\n            sinon_1.default.stub(ChatService_1.ChatService, &#x27;saveChat&#x27;).resolves(mockChat);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chat&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: messagesData\n            })\n                .expect(201);\n            (0, chai_1.expect)(response.body).to.deep.equal(mockChat);\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;679fcc34-3408-4b98-bcb2-6587afd0ad0b&quot;,&quot;parentUUID&quot;:&quot;cd539c05-ecc3-4a77-9d4f-6b0e7464e980&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5ec5eacb-b2e0-4980-8356-b20380a95fa6&quot;,&quot;0a4137eb-9fe3-49b2-8f30-6b9481271d84&quot;,&quot;2bcd552c-1903-4d38-b018-bfa7149f4b1c&quot;,&quot;196d6bea-1d1f-46e4-87b5-1484b5b08c53&quot;,&quot;7cde0371-6c55-4b7e-8683-be539f4a325f&quot;,&quot;925f39e9-7dce-42c7-9f24-3e1c7a098424&quot;,&quot;8110008a-a593-4e23-aaa5-23c019b3300d&quot;,&quot;22dcb328-d6f2-4800-937b-14b060139890&quot;,&quot;f9d77738-0d61-4e5c-a6cd-86f062484294&quot;,&quot;679fcc34-3408-4b98-bcb2-6587afd0ad0b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:80,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;0f91e14f-acaf-430f-9b28-67b1be9a91f9&quot;,&quot;title&quot;:&quot;Chatbot API&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\chatbot.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Chatbot API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Chatbot API \&quot;before all\&quot; hook in \&quot;Chatbot API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(express_1.default.json());\napp.post(&#x27;/api/chatbot&#x27;, chatbot_1.postChat);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bd1d79c0-8b37-4c07-8f62-637868ea1e39&quot;,&quot;parentUUID&quot;:&quot;0f91e14f-acaf-430f-9b28-67b1be9a91f9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Chatbot API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Chatbot API \&quot;after each\&quot; hook in \&quot;Chatbot API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;658b90b6-602a-4eea-ae26-bc5acd4684be&quot;,&quot;parentUUID&quot;:&quot;0f91e14f-acaf-430f-9b28-67b1be9a91f9&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;3de3161b-7b9f-4235-b5dd-dc972dd5f9c0&quot;,&quot;title&quot;:&quot;/api/chatbot POST&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\chatbot.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns 400 code for missing message&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 400 code for missing message&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({})\n                .expect(400);\n            expect(response.body).to.deep.equal({ error: &#x27;Message is required&#x27; });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b93fdb9f-52ee-4653-b0bc-0e53cc341612&quot;,&quot;parentUUID&quot;:&quot;3de3161b-7b9f-4235-b5dd-dc972dd5f9c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 400 code for wrong data type&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 400 code for wrong data type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:13,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: 0 })\n                .expect(400);\n            expect(response.body).to.deep.equal({ error: &#x27;Message must be a string&#x27; });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { error: &#x27;Message is required&#x27; } to deeply equal { error: &#x27;Message must be a string&#x27; }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { error: &#x27;Message is required&#x27; } to deeply equal { error: &#x27;Message must be a string&#x27; }\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:51:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src\\tests\\integration\\chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;error\&quot;: \&quot;Message is required\&quot;\n+   \&quot;error\&quot;: \&quot;Message must be a string\&quot;\n }\n&quot;},&quot;uuid&quot;:&quot;152e606e-c822-4339-9a48-3df7592941eb&quot;,&quot;parentUUID&quot;:&quot;3de3161b-7b9f-4235-b5dd-dc972dd5f9c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 400 code for empty message&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 400 code for empty message&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;\&quot; })\n                .expect(400);\n            expect(response.body).to.deep.equal({ error: &#x27;Message cannot be empty&#x27; });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { error: &#x27;Message is required&#x27; } to deeply equal { error: &#x27;Message cannot be empty&#x27; }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { error: &#x27;Message is required&#x27; } to deeply equal { error: &#x27;Message cannot be empty&#x27; }\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:60:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src\\tests\\integration\\chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;error\&quot;: \&quot;Message is required\&quot;\n+   \&quot;error\&quot;: \&quot;Message cannot be empty\&quot;\n }\n&quot;},&quot;uuid&quot;:&quot;735135ac-3ddb-4eb6-bc3b-dcbabbd98937&quot;,&quot;parentUUID&quot;:&quot;3de3161b-7b9f-4235-b5dd-dc972dd5f9c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 500 code for failed chatbot API call&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 500 code for failed chatbot API call&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2108,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).throws(new Error(\&quot;some API error message\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;hi\&quot; })\n                .expect(500);\n            expect(response.body).to.deep.equal({ error: &#x27;Unable to call chatbot API&#x27; });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 200 \&quot;OK\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 200 \&quot;OK\&quot;\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:68:10\n    at Generator.next (&lt;anonymous&gt;)\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:41:71\n    at new Promise (&lt;anonymous&gt;)\n    at __awaiter (src\\tests\\integration\\chatbot.test.ts:37:12)\n    at Context.&lt;anonymous&gt; (src\\tests\\integration\\chatbot.test.ts:63:67)\n    at processImmediate (node:internal/timers:485:21)\n----\n    at Test._assertStatus (node_modules\\supertest\\lib\\test.js:267:14)\n    at D:\\Uni\\C455\\Project\\team10\\server\\node_modules\\supertest\\lib\\test.js:323:13\n    at Test._assertFunction (node_modules\\supertest\\lib\\test.js:300:13)\n    at Test.assert (node_modules\\supertest\\lib\\test.js:179:23)\n    at Server.localAssert (node_modules\\supertest\\lib\\test.js:135:14)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:518:28)\n    at Server.emit (node:domain:489:12)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)&quot;},&quot;uuid&quot;:&quot;7963eab4-cf5d-40b7-974a-1fbd72cc1ea6&quot;,&quot;parentUUID&quot;:&quot;3de3161b-7b9f-4235-b5dd-dc972dd5f9c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 500 code for incomplete chatbot response&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 500 code for incomplete chatbot response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1374,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).resolves({\n                chatbotMessage: \&quot;\&quot;,\n                productRequested: false,\n                productQuery: \&quot;\&quot;\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;give me an incomplete response\&quot; })\n                .expect(500);\n            expect(response.body).to.deep.equal({ error: &#x27;AI unable to respond&#x27; });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 200 \&quot;OK\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 200 \&quot;OK\&quot;\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:83:10\n    at Generator.next (&lt;anonymous&gt;)\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:41:71\n    at new Promise (&lt;anonymous&gt;)\n    at __awaiter (src\\tests\\integration\\chatbot.test.ts:37:12)\n    at Context.&lt;anonymous&gt; (src\\tests\\integration\\chatbot.test.ts:73:71)\n    at processImmediate (node:internal/timers:485:21)\n----\n    at Test._assertStatus (node_modules\\supertest\\lib\\test.js:267:14)\n    at D:\\Uni\\C455\\Project\\team10\\server\\node_modules\\supertest\\lib\\test.js:323:13\n    at Test._assertFunction (node_modules\\supertest\\lib\\test.js:300:13)\n    at Test.assert (node_modules\\supertest\\lib\\test.js:179:23)\n    at Server.localAssert (node_modules\\supertest\\lib\\test.js:135:14)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:518:28)\n    at Server.emit (node:domain:489:12)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)&quot;},&quot;uuid&quot;:&quot;58332de8-d0cb-42bb-847e-58c963343c37&quot;,&quot;parentUUID&quot;:&quot;3de3161b-7b9f-4235-b5dd-dc972dd5f9c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 200 code for working chatbot API without products&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 200 code for working chatbot API without products&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1729,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).resolves({\n                chatbotMessage: \&quot;What would you like to search for?\&quot;,\n                productRequested: false,\n                productQuery: \&quot;\&quot;\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;test message\&quot; })\n                .expect(200);\n            expect(response.body).to.deep.equal({\n                chatbotMessage: \&quot;What would you like to search for?\&quot;,\n                productData: null\n            });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { …(2) } to deeply equal { …(2) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { …(2) } to deeply equal { …(2) }\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:99:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src\\tests\\integration\\chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;chatbotMessage\&quot;: \&quot;I&#x27;m here to help you find laptops, phones, or computers! Please let me know what type of device you&#x27;re interested in or your specific needs so I can assist you better.\&quot;\n+   \&quot;chatbotMessage\&quot;: \&quot;What would you like to search for?\&quot;\n   \&quot;productData\&quot;: [null]\n }\n&quot;},&quot;uuid&quot;:&quot;834c5e36-81cc-4c18-8635-a2137341353d&quot;,&quot;parentUUID&quot;:&quot;3de3161b-7b9f-4235-b5dd-dc972dd5f9c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 200 code for working chatbot API and failed product API&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 200 code for working chatbot API and failed product API&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1324,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).resolves({\n                chatbotMessage: \&quot;Here are some macbooks I found.\&quot;,\n                productRequested: true,\n                productQuery: \&quot;macbook\&quot;\n            });\n            sinon_1.default.stub(ProductService_1.ProductService, &#x27;searchProducts&#x27;).throws(new Error(\&quot;some API error message\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;I want some macbooks\&quot; })\n                .expect(200);\n            expect(response.body).to.deep.equal({\n                chatbotMessage: \&quot;Here are some macbooks I found.\&quot;,\n                productData: []\n            });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { …(2) } to deeply equal { …(2) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { …(2) } to deeply equal { …(2) }\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:118:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src\\tests\\integration\\chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;chatbotMessage\&quot;: \&quot;You asked about MacBooks. I will now search for available MacBook models to help you find the best options!\&quot;\n-   \&quot;productData\&quot;: [null]\n+   \&quot;chatbotMessage\&quot;: \&quot;Here are some macbooks I found.\&quot;\n+   \&quot;productData\&quot;: []\n }\n&quot;},&quot;uuid&quot;:&quot;6a242613-021c-4c09-9607-5a7ea30e44e5&quot;,&quot;parentUUID&quot;:&quot;3de3161b-7b9f-4235-b5dd-dc972dd5f9c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 200 code for working chatbot API and product API&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 200 code for working chatbot API and product API&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1325,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const mockProduct = {\n                product_id: \&quot;123\&quot;,\n                source: \&quot;Best Buy\&quot;,\n                title: \&quot;MacBook Pro\&quot;,\n                thumbnail: \&quot;image.jpg\&quot;,\n                extracted_price: 1299,\n                seller_details: { direct_link: \&quot;http://example.com\&quot; },\n                rating: 4.5,\n                reviews: 120\n            };\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).resolves({\n                chatbotMessage: \&quot;Here are some macbooks I found.\&quot;,\n                productRequested: true,\n                productQuery: \&quot;macbook\&quot;\n            });\n            sinon_1.default.stub(ProductService_1.ProductService, &#x27;searchProducts&#x27;).resolves([mockProduct]);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;I want some macbooks\&quot; })\n                .expect(200);\n            expect(response.body).to.deep.equal({\n                chatbotMessage: \&quot;Here are some macbooks I found.\&quot;,\n                productData: [{\n                        id: mockProduct.product_id,\n                        source: mockProduct.source,\n                        title: mockProduct.title,\n                        image: mockProduct.thumbnail,\n                        price: mockProduct.extracted_price,\n                        url: mockProduct.seller_details.direct_link,\n                        rating: mockProduct.rating,\n                        reviews: mockProduct.reviews\n                    }]\n            });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { …(2) } to deeply equal { …(2) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { …(2) } to deeply equal { …(2) }\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:147:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src\\tests\\integration\\chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;chatbotMessage\&quot;: \&quot;I found a MacBook Pro available for $1299 with a good rating. You can view it [here](http://example.com). Let me know if you&#x27;d like more options or specific features!\&quot;\n+   \&quot;chatbotMessage\&quot;: \&quot;Here are some macbooks I found.\&quot;\n   \&quot;productData\&quot;: [\n     {\n       \&quot;id\&quot;: \&quot;123\&quot;\n       \&quot;image\&quot;: \&quot;image.jpg\&quot;\n&quot;},&quot;uuid&quot;:&quot;a261e96f-c1af-405c-83ae-d1ad3455704f&quot;,&quot;parentUUID&quot;:&quot;3de3161b-7b9f-4235-b5dd-dc972dd5f9c0&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b93fdb9f-52ee-4653-b0bc-0e53cc341612&quot;],&quot;failures&quot;:[&quot;152e606e-c822-4339-9a48-3df7592941eb&quot;,&quot;735135ac-3ddb-4eb6-bc3b-dcbabbd98937&quot;,&quot;7963eab4-cf5d-40b7-974a-1fbd72cc1ea6&quot;,&quot;58332de8-d0cb-42bb-847e-58c963343c37&quot;,&quot;834c5e36-81cc-4c18-8635-a2137341353d&quot;,&quot;6a242613-021c-4c09-9607-5a7ea30e44e5&quot;,&quot;a261e96f-c1af-405c-83ae-d1ad3455704f&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:7891,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;946b02cd-3842-4e8e-ad52-b53c71746e9b&quot;,&quot;title&quot;:&quot;Products API&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\products.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\products.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Products API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Products API \&quot;before all\&quot; hook in \&quot;Products API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(&#x27;/api/products&#x27;, products_1.default);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;40f8668d-b58d-45e6-9535-4e0c7bb8f57d&quot;,&quot;parentUUID&quot;:&quot;946b02cd-3842-4e8e-ad52-b53c71746e9b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Products API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Products API \&quot;after each\&quot; hook in \&quot;Products API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2b5d4650-606e-4948-aebd-ddce0931396f&quot;,&quot;parentUUID&quot;:&quot;946b02cd-3842-4e8e-ad52-b53c71746e9b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;09c171dc-d743-4c6f-b036-58c368786ad3&quot;,&quot;title&quot;:&quot;GET /api/products/search&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\products.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\products.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 200 and products for a valid search query&quot;,&quot;fullTitle&quot;:&quot;Products API GET /api/products/search should return 200 and products for a valid search query&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeProducts = [\n                {\n                    category: &#x27;Popular products&#x27;,\n                    thumbnail: &#x27;https://example.com/image.jpg&#x27;,\n                    source_logo: &#x27;https://example.com/logo.png&#x27;,\n                    source: &#x27;Best Buy&#x27;,\n                    title: &#x27;HP 14\&quot; Intel Celeron Laptop&#x27;,\n                    rating: 4.2,\n                    reviews: 148,\n                    price: &#x27;$199.99&#x27;,\n                    extracted_price: 199.99,\n                    location: &#x27;Nearby, 13 mi&#x27;,\n                    product_id: &#x27;2197135960910078338&#x27;,\n                    seller_details: [\n                        {\n                            position: 1,\n                            name: &#x27;Best Buy&#x27;,\n                            top_quality_store: true,\n                            payment_methods: &#x27;PayPal, Zip accepted&#x27;,\n                            rating: 4.6,\n                            reviews: 532,\n                            reviews_original: &#x27;(532)&#x27;,\n                            link: &#x27;https://google.com/redirect&#x27;,\n                            direct_link: &#x27;https://bestbuy.com/product&#x27;,\n                            details_and_offers: [{ text: &#x27;5.3 mi · In stock at GainesvilleToday: 10:00 AM - 8:00 PM&#x27; }],\n                            base_price: &#x27;$199.99&#x27;,\n                            additional_price: { shipping: &#x27;See website&#x27; },\n                            total_price: &#x27;$199.99&#x27;,\n                        }\n                    ],\n                },\n            ];\n            sinon_1.default.stub(ProductService_1.ProductService, &#x27;searchProducts&#x27;).resolves(fakeProducts);\n            const res = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/products/search&#x27;)\n                .query({ q: &#x27;Laptop under $400&#x27;, device: &#x27;desktop&#x27;, location: &#x27;Canada&#x27; });\n            (0, chai_1.expect)(res.status).to.equal(200);\n            (0, chai_1.expect)(res.body.success).to.be.true;\n            (0, chai_1.expect)(res.body.products).to.deep.equal(fakeProducts);\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6bc09699-6c64-4387-972d-da9bdca16139&quot;,&quot;parentUUID&quot;:&quot;09c171dc-d743-4c6f-b036-58c368786ad3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the search query is missing&quot;,&quot;fullTitle&quot;:&quot;Products API GET /api/products/search should return 400 if the search query is missing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const res = yield (0, supertest_1.default)(app).get(&#x27;/api/products/search&#x27;);\n            (0, chai_1.expect)(res.status).to.equal(400);\n            (0, chai_1.expect)(res.body.success).to.be.false;\n            (0, chai_1.expect)(res.body.error).to.equal(&#x27;Search query is required&#x27;);\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0d0e6e46-474a-45f2-94dc-5833a1a3a354&quot;,&quot;parentUUID&quot;:&quot;09c171dc-d743-4c6f-b036-58c368786ad3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 if the ProductService throws an error&quot;,&quot;fullTitle&quot;:&quot;Products API GET /api/products/search should return 500 if the ProductService throws an error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(ProductService_1.ProductService, &#x27;searchProducts&#x27;).throws(new Error(&#x27;SerpAPI error&#x27;));\n            const res = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/products/search&#x27;)\n                .query({ q: &#x27;Laptop&#x27; });\n            (0, chai_1.expect)(res.status).to.equal(500);\n            (0, chai_1.expect)(res.body.success).to.be.false;\n            (0, chai_1.expect)(res.body.error).to.equal(&#x27;SerpAPI error&#x27;);\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4ee6b5a8-6122-4748-ac5a-13f18450410c&quot;,&quot;parentUUID&quot;:&quot;09c171dc-d743-4c6f-b036-58c368786ad3&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6bc09699-6c64-4387-972d-da9bdca16139&quot;,&quot;0d0e6e46-474a-45f2-94dc-5833a1a3a354&quot;,&quot;4ee6b5a8-6122-4748-ac5a-13f18450410c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:22,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;88caf5ac-19cd-4b21-bda3-aeff20490c6f&quot;,&quot;title&quot;:&quot;Profile API&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\profile.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\profile.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Profile API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Profile API \&quot;before all\&quot; hook in \&quot;Profile API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(express_1.default.json());\napp.use(&#x27;/api/profiles&#x27;, profile_1.default);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0b169f2b-b7dd-4716-90c7-c7c01faef709&quot;,&quot;parentUUID&quot;:&quot;88caf5ac-19cd-4b21-bda3-aeff20490c6f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Profile API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Profile API \&quot;after each\&quot; hook in \&quot;Profile API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a0c43c0c-a78a-45bb-b34d-b93cf94dbb2f&quot;,&quot;parentUUID&quot;:&quot;88caf5ac-19cd-4b21-bda3-aeff20490c6f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d8640c38-3aac-4656-acd4-b6bf0d303f99&quot;,&quot;title&quot;:&quot;/api/profiles/verify/:token GET&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\profile.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\profile.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing token&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 400 for missing token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify&#x27;)\n                .query({})\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;token missing from params&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;847bfbfa-398a-43e4-9ff8-2325cafa1f2a&quot;,&quot;parentUUID&quot;:&quot;d8640c38-3aac-4656-acd4-b6bf0d303f99&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failing to get user&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 500 for failing to get user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByToken&#x27;).throws(new Error(\&quot;Some error related to getting user\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify/test123&#x27;)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to get user&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;19825d09-a574-48d7-8cb8-96eb0ece3cf5&quot;,&quot;parentUUID&quot;:&quot;d8640c38-3aac-4656-acd4-b6bf0d303f99&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 404 for not finding valid user&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 404 for not finding valid user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByToken&#x27;).resolves(null);\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify/test123&#x27;)\n                .expect(404);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid or expired verification token&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1c6a6088-f2d5-41fb-8dd1-5909fa328c84&quot;,&quot;parentUUID&quot;:&quot;d8640c38-3aac-4656-acd4-b6bf0d303f99&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failing to verify email&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 500 for failing to verify email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeDate = new Date();\n            const fakeUser = {\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                isEmailVerified: true,\n                verificationToken: &#x27;test123&#x27;,\n                verificationTokenExpires: fakeDate,\n                createdAt: fakeDate,\n                updatedAt: fakeDate,\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByToken&#x27;).resolves(fakeUser);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;verifyEmail&#x27;).throws(new Error(\&quot;Some error related to verifying email\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify/test123&#x27;)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to verify email&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5df87b90-692f-4f56-9fcc-3b9addef2ef6&quot;,&quot;parentUUID&quot;:&quot;d8640c38-3aac-4656-acd4-b6bf0d303f99&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for successfully verifying email&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 200 for successfully verifying email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeDate = new Date();\n            const fakeUser = {\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                isEmailVerified: true,\n                verificationToken: &#x27;test123&#x27;,\n                verificationTokenExpires: fakeDate,\n                createdAt: fakeDate,\n                updatedAt: fakeDate,\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByToken&#x27;).resolves(fakeUser);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;verifyEmail&#x27;).resolves();\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify/test123&#x27;)\n                .expect(200);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Email verified successfully&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;01eff648-221c-4ba4-a0c4-2ef627de5e18&quot;,&quot;parentUUID&quot;:&quot;d8640c38-3aac-4656-acd4-b6bf0d303f99&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;847bfbfa-398a-43e4-9ff8-2325cafa1f2a&quot;,&quot;19825d09-a574-48d7-8cb8-96eb0ece3cf5&quot;,&quot;1c6a6088-f2d5-41fb-8dd1-5909fa328c84&quot;,&quot;5df87b90-692f-4f56-9fcc-3b9addef2ef6&quot;,&quot;01eff648-221c-4ba4-a0c4-2ef627de5e18&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:26,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;8f28d754-e3ce-4ea9-a031-4955d358e150&quot;,&quot;title&quot;:&quot;EmailService&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\unit\\EmailService.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\unit\\EmailService.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;EmailService\&quot;&quot;,&quot;fullTitle&quot;:&quot;EmailService \&quot;before each\&quot; hook in \&quot;EmailService\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sendMailStub = sinon_1.default.stub().resolves();\ncreateTransportStub = sinon_1.default.stub(nodemailer_1.default, &#x27;createTransport&#x27;).returns({\n    sendMail: sendMailStub\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cb88d40c-5435-4c3e-bc6c-4ec4278f8735&quot;,&quot;parentUUID&quot;:&quot;8f28d754-e3ce-4ea9-a031-4955d358e150&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;EmailService\&quot;&quot;,&quot;fullTitle&quot;:&quot;EmailService \&quot;after each\&quot; hook in \&quot;EmailService\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;65129cd4-c256-4694-bfdf-7d2021c6e72a&quot;,&quot;parentUUID&quot;:&quot;8f28d754-e3ce-4ea9-a031-4955d358e150&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should send email with correct options&quot;,&quot;fullTitle&quot;:&quot;EmailService should send email with correct options&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:546,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        const email = &#x27;test@example.com&#x27;;\n        const token = &#x27;dummy-token&#x27;;\n        process.env.FRONTEND_URL = &#x27;http://localhost:3000&#x27;;\n        process.env.EMAIL_USER = &#x27;testuser@gmail.com&#x27;;\n        yield emailService.sendVerificationEmail(email, token);\n        (0, chai_1.expect)(sendMailStub.calledOnce).to.be.true;\n        const mailOptions = sendMailStub.firstCall.args[0];\n        (0, chai_1.expect)(mailOptions.to).to.equal(email);\n        (0, chai_1.expect)(mailOptions.from).to.equal(process.env.EMAIL_USER);\n        (0, chai_1.expect)(mailOptions.subject).to.include(&#x27;Verify your BuyWise account&#x27;);\n        (0, chai_1.expect)(mailOptions.html).to.include(`${process.env.FRONTEND_URL}/verify-email?token=${token}`);\n    })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected false to be true&quot;,&quot;estack&quot;:&quot;AssertionError: expected false to be true\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\unit\\EmailService.test.ts:31:42\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src\\tests\\unit\\EmailService.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot;- false\n+ true\n&quot;},&quot;uuid&quot;:&quot;cd53969c-653c-4999-9ad5-d9fc3b57212f&quot;,&quot;parentUUID&quot;:&quot;8f28d754-e3ce-4ea9-a031-4955d358e150&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should throw an error when sending email fails&quot;,&quot;fullTitle&quot;:&quot;EmailService should throw an error when sending email fails&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:164,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        sendMailStub.rejects(new Error(&#x27;SMTP error&#x27;));\n        try {\n            yield emailService.sendVerificationEmail(&#x27;fail@example.com&#x27;, &#x27;token&#x27;);\n            throw new Error(&#x27;Expected method to throw.&#x27;);\n        }\n        catch (err) {\n            (0, chai_1.expect)(err.message).to.equal(&#x27;Failed to send verification email&#x27;);\n        }\n    })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected &#x27;Expected method to throw.&#x27; to equal &#x27;Failed to send verification email&#x27;&quot;,&quot;estack&quot;:&quot;AssertionError: expected &#x27;Expected method to throw.&#x27; to equal &#x27;Failed to send verification email&#x27;\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\unit\\EmailService.test.ts:47:30\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src\\tests\\unit\\EmailService.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot;- Expected method to throw.\n+ Failed to send verification email\n&quot;},&quot;uuid&quot;:&quot;276a1837-9283-49e8-9291-6b87c924e29b&quot;,&quot;parentUUID&quot;:&quot;8f28d754-e3ce-4ea9-a031-4955d358e150&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[&quot;cd53969c-653c-4999-9ad5-d9fc3b57212f&quot;,&quot;276a1837-9283-49e8-9291-6b87c924e29b&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:710,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:20000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;11.7.0&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;all-tests&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportFilename&quot;:&quot;all-tests&quot;},&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;all-tests&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;server&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report\\assets&quot;,&quot;jsonFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\mochawesome-report\\all-tests.json&quot;,&quot;htmlFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\mochawesome-report\\all-tests.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>