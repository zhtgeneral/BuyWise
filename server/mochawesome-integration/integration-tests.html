<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:16,&quot;tests&quot;:86,&quot;passes&quot;:81,&quot;pending&quot;:0,&quot;failures&quot;:5,&quot;start&quot;:&quot;2025-07-04T02:40:37.021Z&quot;,&quot;end&quot;:&quot;2025-07-04T02:40:46.829Z&quot;,&quot;duration&quot;:9808,&quot;testsRegistered&quot;:86,&quot;passPercent&quot;:94.18604651162791,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;ee0ed9a1-2980-4f26-879f-5cc0987c3f97&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;7114af73-476c-4862-9ef1-77dd21a30b64&quot;,&quot;title&quot;:&quot;Auth API&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\auth.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\auth.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Auth API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Auth API \&quot;before all\&quot; hook in \&quot;Auth API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(express_1.default.json());\napp.use(&#x27;/api/auth&#x27;, auth_1.default);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6fa6877e-99df-4dfd-b520-0bf60d6e5a6a&quot;,&quot;parentUUID&quot;:&quot;7114af73-476c-4862-9ef1-77dd21a30b64&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Auth API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Auth API \&quot;after each\&quot; hook in \&quot;Auth API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a1eb78e7-b042-4f9f-8cb7-af74c4025e5a&quot;,&quot;parentUUID&quot;:&quot;7114af73-476c-4862-9ef1-77dd21a30b64&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;87821110-7a88-4cd5-9476-475c8ed95d74&quot;,&quot;title&quot;:&quot;/api/auth/register POST&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\auth.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\auth.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing name&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for missing name&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:46,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password are required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d2fb729f-1bcf-4f44-a013-8d50bba1ec6b&quot;,&quot;parentUUID&quot;:&quot;87821110-7a88-4cd5-9476-475c8ed95d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for missing email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test name&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password are required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ad46e8a8-3d33-4c64-a9d1-c559ab4e5958&quot;,&quot;parentUUID&quot;:&quot;87821110-7a88-4cd5-9476-475c8ed95d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing password&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for missing password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password are required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a3575a82-3d13-42ef-bb47-1ca5fbb45eae&quot;,&quot;parentUUID&quot;:&quot;87821110-7a88-4cd5-9476-475c8ed95d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string name&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for non string name&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: 123,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password need to be strings&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;40b6b081-d3c6-4111-85c0-522a2f47c47d&quot;,&quot;parentUUID&quot;:&quot;87821110-7a88-4cd5-9476-475c8ed95d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for non string email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test name&#x27;,\n                email: 123,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password need to be strings&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;734f219e-7084-44fb-855d-b2e76cfd3b70&quot;,&quot;parentUUID&quot;:&quot;87821110-7a88-4cd5-9476-475c8ed95d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string password&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for non string password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: 123\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;name, email and password need to be strings&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e949caf7-9c87-4758-8e9c-e4c1028318f2&quot;,&quot;parentUUID&quot;:&quot;87821110-7a88-4cd5-9476-475c8ed95d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failed email validation&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 500 for failed email validation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).throws(new Error(\&quot;Error related to searching user with email\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test user&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to register with that email&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c8289955-6ce1-405d-93de-b38ef7f8ef99&quot;,&quot;parentUUID&quot;:&quot;87821110-7a88-4cd5-9476-475c8ed95d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for existing account&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 400 for existing account&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves({\n                _id: &#x27;existing_id&#x27;,\n                name: &#x27;Existing User&#x27;,\n                email: &#x27;existing@example.com&#x27;,\n                password: &#x27;hashed_password&#x27;,\n                isEmailVerified: true\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test user&#x27;,\n                email: &#x27;existing@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Email already exists. Please try logging in instead&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;59a0faf4-fd9a-4928-a0d2-45060f0b5e86&quot;,&quot;parentUUID&quot;:&quot;87821110-7a88-4cd5-9476-475c8ed95d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failed register&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 500 for failed register&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:68,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(null);\n            sinon_1.default.stub(authService_1.AuthService, &#x27;register&#x27;).throws(new Error(\&quot;Unknown error in register\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test user&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Registration failed. Please try again&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3bfdef12-c42b-47f5-a6a9-cdc322e68f53&quot;,&quot;parentUUID&quot;:&quot;87821110-7a88-4cd5-9476-475c8ed95d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 201 on successful register&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/register POST should return 201 on successful register&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:56,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;medium&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeUser = {\n                _id: &#x27;test user id&#x27;,\n                name: &#x27;test user&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                isEmailVerified: true,\n                verificationToken: &#x27;test token&#x27;,\n                verificationTokenExpires: (new Date(Date.now() + 24 * 60 * 60 * 1000)).toISOString(),\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(null);\n            sinon_1.default.stub(authService_1.AuthService, &#x27;register&#x27;).resolves({\n                token: &#x27;123abc&#x27;,\n                user: fakeUser\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/register&#x27;)\n                .send({\n                name: &#x27;test user&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;password123&#x27;\n            })\n                .expect(201);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Registration successful! Your account has been created and verified&#x27;,\n                data: fakeUser,\n                token: &#x27;123abc&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;542a6c2a-9c01-4d3f-b0fb-3689cace3135&quot;,&quot;parentUUID&quot;:&quot;87821110-7a88-4cd5-9476-475c8ed95d74&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d2fb729f-1bcf-4f44-a013-8d50bba1ec6b&quot;,&quot;ad46e8a8-3d33-4c64-a9d1-c559ab4e5958&quot;,&quot;a3575a82-3d13-42ef-bb47-1ca5fbb45eae&quot;,&quot;40b6b081-d3c6-4111-85c0-522a2f47c47d&quot;,&quot;734f219e-7084-44fb-855d-b2e76cfd3b70&quot;,&quot;e949caf7-9c87-4758-8e9c-e4c1028318f2&quot;,&quot;c8289955-6ce1-405d-93de-b38ef7f8ef99&quot;,&quot;59a0faf4-fd9a-4928-a0d2-45060f0b5e86&quot;,&quot;3bfdef12-c42b-47f5-a6a9-cdc322e68f53&quot;,&quot;542a6c2a-9c01-4d3f-b0fb-3689cace3135&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:220,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f139776c-bdeb-4d3a-bd5b-95d989b4a230&quot;,&quot;title&quot;:&quot;/api/auth/login POST&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\auth.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\auth.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 400 for missing email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                password: &#x27;hashed-password&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Email and password are required\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d0f8eba8-eb2a-4605-af0a-669ca2f4604a&quot;,&quot;parentUUID&quot;:&quot;f139776c-bdeb-4d3a-bd5b-95d989b4a230&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing password&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 400 for missing password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: \&quot;test@example.com\&quot;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Email and password are required\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aca3ff54-8c16-4b29-96b2-f927fb623408&quot;,&quot;parentUUID&quot;:&quot;f139776c-bdeb-4d3a-bd5b-95d989b4a230&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 400 for non string email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: 123,\n                password: &#x27;test-hash&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Email and password must be strings\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5bdbf97d-baa4-4e69-9e19-5557601f98d3&quot;,&quot;parentUUID&quot;:&quot;f139776c-bdeb-4d3a-bd5b-95d989b4a230&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string password&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 400 for non string password&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: 123\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Email and password must be strings\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a5b30fcb-14ca-42f8-881d-aa87cfc4c4bd&quot;,&quot;parentUUID&quot;:&quot;f139776c-bdeb-4d3a-bd5b-95d989b4a230&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 401 for bad email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 401 for bad email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(null);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;\n            })\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Invalid email or password\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f5edc616-7cfc-41df-8025-e33b1ef9ed25&quot;,&quot;parentUUID&quot;:&quot;f139776c-bdeb-4d3a-bd5b-95d989b4a230&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 401 for unverified email&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 401 for unverified email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const unverifiedUser = {\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;,\n                isEmailVerified: false\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(unverifiedUser);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;\n            })\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Please verify your email before logging in\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;df51cb1c-200e-4a12-9d7b-01300cbd641d&quot;,&quot;parentUUID&quot;:&quot;f139776c-bdeb-4d3a-bd5b-95d989b4a230&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unknown error during login&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 500 for unknown error during login&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const userWithPassword = {\n                _id: &#x27;test_id&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;,\n                isEmailVerified: true\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(userWithPassword);\n            sinon_1.default.stub(authService_1.AuthService, &#x27;login&#x27;).throws(new Error(\&quot;Some error during login\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test-hash&#x27;\n            })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: \&quot;Unknown authentication error\&quot;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;36c8dc85-fca6-4080-8377-7ec6278ea1e0&quot;,&quot;parentUUID&quot;:&quot;f139776c-bdeb-4d3a-bd5b-95d989b4a230&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 with token and user for successful login&quot;,&quot;fullTitle&quot;:&quot;Auth API /api/auth/login POST should return 200 with token and user for successful login&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const userWithPassword = {\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;hashed-password&#x27;,\n                isEmailVerified: true,\n            };\n            const { password } = userWithPassword, userWithoutPassword = __rest(userWithPassword, [\&quot;password\&quot;]);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(userWithPassword);\n            sinon_1.default.stub(authService_1.AuthService, &#x27;login&#x27;).resolves({\n                token: &#x27;token123&#x27;,\n                user: userWithoutPassword\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/auth/login&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;hashed-password&#x27;\n            })\n                .expect(200);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Login successful&#x27;,\n                user: userWithoutPassword,\n                token: &#x27;token123&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d4ed5811-e802-4159-bb65-cb868a561160&quot;,&quot;parentUUID&quot;:&quot;f139776c-bdeb-4d3a-bd5b-95d989b4a230&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;d0f8eba8-eb2a-4605-af0a-669ca2f4604a&quot;,&quot;aca3ff54-8c16-4b29-96b2-f927fb623408&quot;,&quot;5bdbf97d-baa4-4e69-9e19-5557601f98d3&quot;,&quot;a5b30fcb-14ca-42f8-881d-aa87cfc4c4bd&quot;,&quot;f5edc616-7cfc-41df-8025-e33b1ef9ed25&quot;,&quot;df51cb1c-200e-4a12-9d7b-01300cbd641d&quot;,&quot;36c8dc85-fca6-4080-8377-7ec6278ea1e0&quot;,&quot;d4ed5811-e802-4159-bb65-cb868a561160&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:61,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;42ea2432-8caa-42f6-9c78-e2e6ec47a89a&quot;,&quot;title&quot;:&quot;Chatbot API&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\chatbot.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Chatbot API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Chatbot API \&quot;before all\&quot; hook in \&quot;Chatbot API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(express_1.default.json());\napp.post(&#x27;/api/chatbot&#x27;, chatbot_1.postChat);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8db40098-0d0e-4105-90a5-1f694e92492a&quot;,&quot;parentUUID&quot;:&quot;42ea2432-8caa-42f6-9c78-e2e6ec47a89a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Chatbot API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Chatbot API \&quot;after each\&quot; hook in \&quot;Chatbot API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8b590db2-d91a-4320-ad5e-9f434da58540&quot;,&quot;parentUUID&quot;:&quot;42ea2432-8caa-42f6-9c78-e2e6ec47a89a&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;61ac60e2-9ee9-496f-908e-7893bb766341&quot;,&quot;title&quot;:&quot;/api/chatbot POST&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\chatbot.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;returns 400 code for missing message&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 400 code for missing message&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({})\n                .expect(400);\n            expect(response.body).to.deep.equal({ error: &#x27;Message is required&#x27; });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;a799b15d-ae16-46fd-8ecf-7de2152ddc9c&quot;,&quot;parentUUID&quot;:&quot;61ac60e2-9ee9-496f-908e-7893bb766341&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 400 code for wrong data type&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 400 code for wrong data type&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: 0 })\n                .expect(400);\n            expect(response.body).to.deep.equal({ error: &#x27;Message is required&#x27; });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b008cf44-a57e-4087-8124-ea004fc21df8&quot;,&quot;parentUUID&quot;:&quot;61ac60e2-9ee9-496f-908e-7893bb766341&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 400 code for empty message&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 400 code for empty message&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;\&quot; })\n                .expect(400);\n            expect(response.body).to.deep.equal({ error: &#x27;Message is required&#x27; });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2f37714d-bff8-4225-8f7f-c69f1f98d4e2&quot;,&quot;parentUUID&quot;:&quot;61ac60e2-9ee9-496f-908e-7893bb766341&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 500 code for failed chatbot API call&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 500 code for failed chatbot API call&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1588,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).throws(new Error(\&quot;some API error message\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;hi\&quot; })\n                .expect(500);\n            expect(response.body).to.deep.equal({ error: &#x27;Unable to call chatbot API&#x27; });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 200 \&quot;OK\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 200 \&quot;OK\&quot;\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:68:10\n    at Generator.next (&lt;anonymous&gt;)\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:41:71\n    at new Promise (&lt;anonymous&gt;)\n    at __awaiter (src\\tests\\integration\\chatbot.test.ts:37:12)\n    at Context.&lt;anonymous&gt; (src\\tests\\integration\\chatbot.test.ts:63:67)\n    at processImmediate (node:internal/timers:485:21)\n----\n    at Test._assertStatus (node_modules\\supertest\\lib\\test.js:267:14)\n    at D:\\Uni\\C455\\Project\\team10\\server\\node_modules\\supertest\\lib\\test.js:323:13\n    at Test._assertFunction (node_modules\\supertest\\lib\\test.js:300:13)\n    at Test.assert (node_modules\\supertest\\lib\\test.js:179:23)\n    at Server.localAssert (node_modules\\supertest\\lib\\test.js:135:14)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:518:28)\n    at Server.emit (node:domain:489:12)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)&quot;},&quot;uuid&quot;:&quot;78a3ce65-5d35-4042-9b2e-9c5cdb64c9eb&quot;,&quot;parentUUID&quot;:&quot;61ac60e2-9ee9-496f-908e-7893bb766341&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 500 code for incomplete chatbot response&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 500 code for incomplete chatbot response&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1628,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).resolves({\n                chatbotMessage: \&quot;\&quot;,\n                productRequested: false,\n                productQuery: \&quot;\&quot;\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;give me an incomplete response\&quot; })\n                .expect(500);\n            expect(response.body).to.deep.equal({ error: &#x27;AI unable to respond&#x27; });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 200 \&quot;OK\&quot;&quot;,&quot;estack&quot;:&quot;Error: expected 500 \&quot;Internal Server Error\&quot;, got 200 \&quot;OK\&quot;\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:83:10\n    at Generator.next (&lt;anonymous&gt;)\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:41:71\n    at new Promise (&lt;anonymous&gt;)\n    at __awaiter (src\\tests\\integration\\chatbot.test.ts:37:12)\n    at Context.&lt;anonymous&gt; (src\\tests\\integration\\chatbot.test.ts:73:71)\n    at processImmediate (node:internal/timers:485:21)\n----\n    at Test._assertStatus (node_modules\\supertest\\lib\\test.js:267:14)\n    at D:\\Uni\\C455\\Project\\team10\\server\\node_modules\\supertest\\lib\\test.js:323:13\n    at Test._assertFunction (node_modules\\supertest\\lib\\test.js:300:13)\n    at Test.assert (node_modules\\supertest\\lib\\test.js:179:23)\n    at Server.localAssert (node_modules\\supertest\\lib\\test.js:135:14)\n    at Object.onceWrapper (node:events:632:28)\n    at Server.emit (node:events:518:28)\n    at Server.emit (node:domain:489:12)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)&quot;},&quot;uuid&quot;:&quot;124a7fc7-444a-49b5-841b-204724a2804c&quot;,&quot;parentUUID&quot;:&quot;61ac60e2-9ee9-496f-908e-7893bb766341&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 200 code for working chatbot API without products&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 200 code for working chatbot API without products&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1361,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).resolves({\n                chatbotMessage: \&quot;What would you like to search for?\&quot;,\n                productRequested: false,\n                productQuery: \&quot;\&quot;\n            });\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;test message\&quot; })\n                .expect(200);\n            expect(response.body).to.deep.equal({\n                chatbotMessage: \&quot;What would you like to search for?\&quot;,\n                productData: null\n            });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { …(2) } to deeply equal { …(2) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { …(2) } to deeply equal { …(2) }\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:99:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src\\tests\\integration\\chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;chatbotMessage\&quot;: \&quot;It looks like your last message was a test message and not related to tech shopping. How can I assist you with laptops, phones, or computers today?\&quot;\n+   \&quot;chatbotMessage\&quot;: \&quot;What would you like to search for?\&quot;\n   \&quot;productData\&quot;: [null]\n }\n&quot;},&quot;uuid&quot;:&quot;09e99302-977b-4496-9160-7978ed811a6d&quot;,&quot;parentUUID&quot;:&quot;61ac60e2-9ee9-496f-908e-7893bb766341&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 200 code for working chatbot API and failed product API&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 200 code for working chatbot API and failed product API&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1601,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).resolves({\n                chatbotMessage: \&quot;Here are some macbooks I found.\&quot;,\n                productRequested: true,\n                productQuery: \&quot;macbook\&quot;\n            });\n            sinon_1.default.stub(ProductService_1.ProductService, &#x27;searchProducts&#x27;).throws(new Error(\&quot;some API error message\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;I want some macbooks\&quot; })\n                .expect(200);\n            expect(response.body).to.deep.equal({\n                chatbotMessage: \&quot;Here are some macbooks I found.\&quot;,\n                productData: null\n            });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { …(2) } to deeply equal { …(2) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { …(2) } to deeply equal { …(2) }\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:118:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src\\tests\\integration\\chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;chatbotMessage\&quot;: \&quot;You asked about MacBooks. I have searched for MacBook options for you. Would you like to see the latest models, compare prices, or get recommendations based on your needs?\&quot;\n+   \&quot;chatbotMessage\&quot;: \&quot;Here are some macbooks I found.\&quot;\n   \&quot;productData\&quot;: [null]\n }\n&quot;},&quot;uuid&quot;:&quot;e41be74d-f1ef-43e4-bd7a-e460115f23fb&quot;,&quot;parentUUID&quot;:&quot;61ac60e2-9ee9-496f-908e-7893bb766341&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;returns 200 code for working chatbot API and product API&quot;,&quot;fullTitle&quot;:&quot;Chatbot API /api/chatbot POST returns 200 code for working chatbot API and product API&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2787,&quot;state&quot;:&quot;failed&quot;,&quot;pass&quot;:false,&quot;fail&quot;:true,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const mockProduct = {\n                product_id: \&quot;123\&quot;,\n                source: \&quot;Best Buy\&quot;,\n                title: \&quot;MacBook Pro\&quot;,\n                thumbnail: \&quot;image.jpg\&quot;,\n                extracted_price: 1299,\n                seller_details: { direct_link: \&quot;http://example.com\&quot; },\n                rating: 4.5,\n                reviews: 120\n            };\n            sinon_1.default.stub(AIService_1.AIService, &#x27;chatCompletionGithubModel&#x27;).resolves({\n                chatbotMessage: \&quot;Here are some macbooks I found.\&quot;,\n                productRequested: true,\n                productQuery: \&quot;macbook\&quot;\n            });\n            sinon_1.default.stub(ProductService_1.ProductService, &#x27;searchProducts&#x27;).resolves([mockProduct]);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chatbot&#x27;)\n                .send({ message: \&quot;I want some macbooks\&quot; })\n                .expect(200);\n            expect(response.body).to.deep.equal({\n                chatbotMessage: \&quot;Here are some macbooks I found.\&quot;,\n                productData: [{\n                        id: mockProduct.product_id,\n                        source: mockProduct.source,\n                        title: mockProduct.title,\n                        image: mockProduct.thumbnail,\n                        price: mockProduct.extracted_price,\n                        url: mockProduct.seller_details.direct_link,\n                        rating: mockProduct.rating,\n                        reviews: mockProduct.reviews\n                    }]\n            });\n        })&quot;,&quot;err&quot;:{&quot;message&quot;:&quot;AssertionError: expected { …(2) } to deeply equal { …(2) }&quot;,&quot;estack&quot;:&quot;AssertionError: expected { …(2) } to deeply equal { …(2) }\n    at D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chatbot.test.ts:147:37\n    at Generator.next (&lt;anonymous&gt;)\n    at fulfilled (src\\tests\\integration\\chatbot.test.ts:38:58)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)&quot;,&quot;diff&quot;:&quot; {\n-   \&quot;chatbotMessage\&quot;: \&quot;I found a MacBook Pro available for $1299 with a 4.5-star rating and 120 reviews. You can view it [here](http://localhost:3000/api/buywise/redirect/1751596844432-ti7zva?data=eyJvcmlnaW5hbFVybCI6Imh0dHA6Ly9leGFtcGxlLmNvbSIsInBhcmFtcyI6eyJwcm9kdWN0X2lkIjoiMTIzIiwic291cmNlIjoiQmVzdCBCdXkifQ==). Would you like to see more options or need help with anything else?\&quot;\n+   \&quot;chatbotMessage\&quot;: \&quot;Here are some macbooks I found.\&quot;\n   \&quot;productData\&quot;: [\n     {\n       \&quot;id\&quot;: \&quot;123\&quot;\n       \&quot;image\&quot;: \&quot;image.jpg\&quot;\n       \&quot;rating\&quot;: 4.5\n       \&quot;reviews\&quot;: 120\n       \&quot;source\&quot;: \&quot;Best Buy\&quot;\n       \&quot;title\&quot;: \&quot;MacBook Pro\&quot;\n-       \&quot;url\&quot;: \&quot;http://localhost:3000/api/buywise/redirect/1751596844432-ti7zva?data=eyJvcmlnaW5hbFVybCI6Imh0dHA6Ly9leGFtcGxlLmNvbSIsInBhcmFtcyI6eyJwcm9kdWN0X2lkIjoiMTIzIiwic291cmNlIjoiQmVzdCBCdXkiLCJ0aXRsZSI6Ik1hY0Jvb2sgUHJvIiwicHJpY2UiOjEyOTl9LCJyZWRpcmVjdFVybCI6Imh0dHA6Ly9leGFtcGxlLmNvbT9wcm9kdWN0X2lkPTEyMyZzb3VyY2U9QmVzdCtCdXkmdGl0bGU9TWFjQm9vaytQcm8mcHJpY2U9MTI5OSJ9\&quot;\n+       \&quot;url\&quot;: \&quot;http://example.com\&quot;\n     }\n   ]\n }\n&quot;},&quot;uuid&quot;:&quot;f11f31df-56c3-493f-b6c4-68faef799138&quot;,&quot;parentUUID&quot;:&quot;61ac60e2-9ee9-496f-908e-7893bb766341&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;a799b15d-ae16-46fd-8ecf-7de2152ddc9c&quot;,&quot;b008cf44-a57e-4087-8124-ea004fc21df8&quot;,&quot;2f37714d-bff8-4225-8f7f-c69f1f98d4e2&quot;],&quot;failures&quot;:[&quot;78a3ce65-5d35-4042-9b2e-9c5cdb64c9eb&quot;,&quot;124a7fc7-444a-49b5-841b-204724a2804c&quot;,&quot;09e99302-977b-4496-9160-7978ed811a6d&quot;,&quot;e41be74d-f1ef-43e4-bd7a-e460115f23fb&quot;,&quot;f11f31df-56c3-493f-b6c4-68faef799138&quot;],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:8984,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c4301a8b-71db-46f1-89eb-8297d46a9e47&quot;,&quot;title&quot;:&quot;Chat API&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chats.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\chats.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Chat API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Chat API \&quot;before all\&quot; hook in \&quot;Chat API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(express_1.default.json());\napp.use(&#x27;/api/chats&#x27;, chat_1.default);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;24b4e8bd-59be-45a4-969d-97e4ab1aeece&quot;,&quot;parentUUID&quot;:&quot;c4301a8b-71db-46f1-89eb-8297d46a9e47&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Chat API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Chat API \&quot;after each\&quot; hook in \&quot;Chat API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7160178c-e190-4d20-a255-f689efbe4a7b&quot;,&quot;parentUUID&quot;:&quot;c4301a8b-71db-46f1-89eb-8297d46a9e47&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5f0e10e1-9489-4a16-ad8b-0194ba0ab79b&quot;,&quot;title&quot;:&quot;/api/chats POST&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chats.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\chats.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats POST should return 400 for missing messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chats&#x27;)\n                .send({\n                email: &#x27;test@example.com&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;messages and email required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;dafcd8e1-ea92-4b39-8884-a0c1ae246000&quot;,&quot;parentUUID&quot;:&quot;5f0e10e1-9489-4a16-ad8b-0194ba0ab79b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing email&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats POST should return 400 for missing email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chats&#x27;)\n                .send({\n                messages: [\n                    {\n                        speaker: &#x27;user&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first reply&#x27;\n                    }\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;messages and email required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4e9fcfcb-ddbd-4346-b569-46a365d5b301&quot;,&quot;parentUUID&quot;:&quot;5f0e10e1-9489-4a16-ad8b-0194ba0ab79b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string email&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats POST should return 400 for non string email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chats&#x27;)\n                .send({\n                email: 123,\n                messages: [\n                    {\n                        speaker: &#x27;user&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first reply&#x27;\n                    }\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;email needs to be a string&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;64a9f0cc-5563-4621-9418-d85428ef367d&quot;,&quot;parentUUID&quot;:&quot;5f0e10e1-9489-4a16-ad8b-0194ba0ab79b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non array messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats POST should return 400 for non array messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chats&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: &#x27;filler&#x27;\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;messages needs to be an array&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0bd017e0-042b-4b2d-bceb-2d652f001ec1&quot;,&quot;parentUUID&quot;:&quot;5f0e10e1-9489-4a16-ad8b-0194ba0ab79b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing text in messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats POST should return 400 for missing text in messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chats&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;user&#x27;,\n                    },\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid speaker or text found on message&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d1fa9790-19b1-483a-8256-b3927fcf141c&quot;,&quot;parentUUID&quot;:&quot;5f0e10e1-9489-4a16-ad8b-0194ba0ab79b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing speaker in messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats POST should return 400 for missing speaker in messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chats&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        text: &#x27;first reply&#x27;\n                    },\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid speaker or text found on message&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2076ea4c-2184-42f1-8faf-89a4a0a5ac58&quot;,&quot;parentUUID&quot;:&quot;5f0e10e1-9489-4a16-ad8b-0194ba0ab79b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for invalid speaker in messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats POST should return 400 for invalid speaker in messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chats&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;NOT A BOT OR A USER&#x27;,\n                        text: &#x27;first reply&#x27;\n                    }\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid speaker or text found on message&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e3cfad2c-1fc7-4e04-9121-85b57bcdafe8&quot;,&quot;parentUUID&quot;:&quot;5f0e10e1-9489-4a16-ad8b-0194ba0ab79b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string text in messages&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats POST should return 400 for non string text in messages&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chats&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;user&#x27;,\n                        text: 12345\n                    }\n                ]\n            })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid speaker or text found on message&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b82224aa-4622-4bbf-807c-a75aff51a4e0&quot;,&quot;parentUUID&quot;:&quot;5f0e10e1-9489-4a16-ad8b-0194ba0ab79b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failed save chat&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats POST should return 500 for failed save chat&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(ChatService_1.ChatService, &#x27;saveChat&#x27;).throws(new Error(\&quot;Some error in save chat\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chats&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: [\n                    {\n                        speaker: &#x27;bot&#x27;,\n                        text: &#x27;first message&#x27;\n                    },\n                    {\n                        speaker: &#x27;user&#x27;,\n                        text: &#x27;first reply&#x27;\n                    }\n                ]\n            })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to save chat&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;18e5ea8b-c93e-4462-829e-6f077df6e4c1&quot;,&quot;parentUUID&quot;:&quot;5f0e10e1-9489-4a16-ad8b-0194ba0ab79b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 201 for working save chat&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats POST should return 201 for working save chat&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const testDate = new Date(&#x27;2025-06-30T01:14:27.853Z&#x27;).toISOString();\n            const messagesData = [\n                {\n                    speaker: &#x27;bot&#x27;,\n                    text: &#x27;first message&#x27;,\n                    timestamp: testDate\n                },\n                {\n                    speaker: &#x27;user&#x27;,\n                    text: &#x27;first reply&#x27;,\n                    timestamp: testDate\n                }\n            ];\n            const mockChat = {\n                messages: messagesData,\n                email: &#x27;text@example.com&#x27;,\n                createdAt: testDate\n            };\n            sinon_1.default.stub(ChatService_1.ChatService, &#x27;saveChat&#x27;).resolves(mockChat);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/chats&#x27;)\n                .send({\n                email: &#x27;text@example.com&#x27;,\n                messages: messagesData\n            })\n                .expect(201);\n            (0, chai_1.expect)(response.body).to.deep.equal(mockChat);\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;89070baa-398f-491f-b4a4-2c4c30815871&quot;,&quot;parentUUID&quot;:&quot;5f0e10e1-9489-4a16-ad8b-0194ba0ab79b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;dafcd8e1-ea92-4b39-8884-a0c1ae246000&quot;,&quot;4e9fcfcb-ddbd-4346-b569-46a365d5b301&quot;,&quot;64a9f0cc-5563-4621-9418-d85428ef367d&quot;,&quot;0bd017e0-042b-4b2d-bceb-2d652f001ec1&quot;,&quot;d1fa9790-19b1-483a-8256-b3927fcf141c&quot;,&quot;2076ea4c-2184-42f1-8faf-89a4a0a5ac58&quot;,&quot;e3cfad2c-1fc7-4e04-9121-85b57bcdafe8&quot;,&quot;b82224aa-4622-4bbf-807c-a75aff51a4e0&quot;,&quot;18e5ea8b-c93e-4462-829e-6f077df6e4c1&quot;,&quot;89070baa-398f-491f-b4a4-2c4c30815871&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;c9e7fd25-a731-4031-9133-9e7fc0e213b1&quot;,&quot;title&quot;:&quot;/api/chats GET&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\chats.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\chats.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing email on query params&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats GET should return 400 for missing email on query params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/chats&#x27;)\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;email missing from query params&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bd436d14-94d3-495f-95bc-8cb2fe50ea7e&quot;,&quot;parentUUID&quot;:&quot;c9e7fd25-a731-4031-9133-9e7fc0e213b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unknown error during fetch&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats GET should return 500 for unknown error during fetch&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:14,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(ChatService_1.ChatService, &#x27;getChatsByEmail&#x27;).throws(new Error(\&quot;Some error related to fetching chats\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/chats?email=test@example.com&#x27;)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Failed to fetch chats&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4f4f3a12-e43b-4ed0-8cc9-cf82ed62259c&quot;,&quot;parentUUID&quot;:&quot;c9e7fd25-a731-4031-9133-9e7fc0e213b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for successful fetch&quot;,&quot;fullTitle&quot;:&quot;Chat API /api/chats GET should return 200 for successful fetch&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const testDate = new Date(&#x27;2025-06-30T01:14:27.853Z&#x27;).toISOString();\n            const fakeChats = [\n                {\n                    \&quot;_id\&quot;: \&quot;507f1f77bcf86cd799439011\&quot;,\n                    \&quot;email\&quot;: \&quot;test@example.com\&quot;,\n                    \&quot;messages\&quot;: [\n                        {\n                            \&quot;speaker\&quot;: \&quot;user\&quot;,\n                            \&quot;text\&quot;: \&quot;I want macbooks\&quot;,\n                            \&quot;timestamp\&quot;: testDate\n                        },\n                        {\n                            \&quot;speaker\&quot;: \&quot;bot\&quot;,\n                            \&quot;text\&quot;: \&quot;Here are some macbooks I found!\&quot;,\n                            \&quot;timestamp\&quot;: testDate,\n                            \&quot;recommendedProducts\&quot;: [\n                                {\n                                    id: &#x27;product id&#x27;,\n                                    source: &#x27;Apple&#x27;,\n                                    title: &#x27;macbook air&#x27;,\n                                    image: &#x27;some image url&#x27;,\n                                    price: 1400,\n                                    url: &#x27;some url&#x27;,\n                                    rating: 4.5,\n                                    reviews: 220\n                                },\n                                {\n                                    id: &#x27;product id&#x27;,\n                                    source: &#x27;Apple&#x27;,\n                                    title: &#x27;macbook mini&#x27;,\n                                    image: &#x27;some image url&#x27;,\n                                    price: 1300,\n                                    url: &#x27;some url&#x27;,\n                                    rating: 4.0,\n                                    reviews: 30\n                                }\n                            ]\n                        }\n                    ],\n                    \&quot;createdAt\&quot;: testDate,\n                    \&quot;updatedAt\&quot;: testDate\n                },\n                {\n                    \&quot;_id\&quot;: \&quot;507f1f77bcf86cd799439012\&quot;,\n                    \&quot;email\&quot;: \&quot;test@example.com\&quot;,\n                    \&quot;messages\&quot;: [\n                        {\n                            \&quot;speaker\&quot;: \&quot;user\&quot;,\n                            \&quot;text\&quot;: \&quot;How are you?\&quot;,\n                            \&quot;timestamp\&quot;: testDate\n                        },\n                        {\n                            \&quot;speaker\&quot;: \&quot;bot\&quot;,\n                            \&quot;text\&quot;: \&quot;Let&#x27;s keep this chat focused on electronics!\&quot;,\n                            \&quot;timestamp\&quot;: testDate,\n                            \&quot;recommendedProducts\&quot;: []\n                        }\n                    ],\n                    \&quot;createdAt\&quot;: testDate,\n                    \&quot;updatedAt\&quot;: testDate\n                }\n            ];\n            sinon_1.default.stub(ChatService_1.ChatService, &#x27;getChatsByEmail&#x27;).resolves(fakeChats);\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/chats?email=test@example.com&#x27;)\n                .expect(200);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                chats: fakeChats\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;61fca963-d267-4571-ac84-bb3bdf8e3d10&quot;,&quot;parentUUID&quot;:&quot;c9e7fd25-a731-4031-9133-9e7fc0e213b1&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;bd436d14-94d3-495f-95bc-8cb2fe50ea7e&quot;,&quot;4f4f3a12-e43b-4ed0-8cc9-cf82ed62259c&quot;,&quot;61fca963-d267-4571-ac84-bb3bdf8e3d10&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:25,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;4a972222-81d6-4055-adff-63591d027552&quot;,&quot;title&quot;:&quot;Products API&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\products.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\products.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Products API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Products API \&quot;before all\&quot; hook in \&quot;Products API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(&#x27;/api/products&#x27;, products_1.default);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9c0189af-73ee-40fb-9180-083565db4908&quot;,&quot;parentUUID&quot;:&quot;4a972222-81d6-4055-adff-63591d027552&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Products API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Products API \&quot;after each\&quot; hook in \&quot;Products API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f6368e68-615d-4ab2-8e14-d4bb4fd6c961&quot;,&quot;parentUUID&quot;:&quot;4a972222-81d6-4055-adff-63591d027552&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;1e7c3908-249c-4093-9ede-3fb3bf8cdc14&quot;,&quot;title&quot;:&quot;GET /api/products/search&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\products.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\products.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 200 and products for a valid search query&quot;,&quot;fullTitle&quot;:&quot;Products API GET /api/products/search should return 200 and products for a valid search query&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeProducts = [\n                {\n                    category: &#x27;Popular products&#x27;,\n                    thumbnail: &#x27;https://example.com/image.jpg&#x27;,\n                    source_logo: &#x27;https://example.com/logo.png&#x27;,\n                    source: &#x27;Best Buy&#x27;,\n                    title: &#x27;HP 14\&quot; Intel Celeron Laptop&#x27;,\n                    rating: 4.2,\n                    reviews: 148,\n                    price: &#x27;$199.99&#x27;,\n                    extracted_price: 199.99,\n                    location: &#x27;Nearby, 13 mi&#x27;,\n                    product_id: &#x27;2197135960910078338&#x27;,\n                    seller_details: [\n                        {\n                            position: 1,\n                            name: &#x27;Best Buy&#x27;,\n                            top_quality_store: true,\n                            payment_methods: &#x27;PayPal, Zip accepted&#x27;,\n                            rating: 4.6,\n                            reviews: 532,\n                            reviews_original: &#x27;(532)&#x27;,\n                            link: &#x27;https://google.com/redirect&#x27;,\n                            direct_link: &#x27;https://bestbuy.com/product&#x27;,\n                            details_and_offers: [{ text: &#x27;5.3 mi · In stock at GainesvilleToday: 10:00 AM - 8:00 PM&#x27; }],\n                            base_price: &#x27;$199.99&#x27;,\n                            additional_price: { shipping: &#x27;See website&#x27; },\n                            total_price: &#x27;$199.99&#x27;,\n                        }\n                    ],\n                },\n            ];\n            sinon_1.default.stub(ProductService_1.ProductService, &#x27;searchProducts&#x27;).resolves(fakeProducts);\n            const res = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/products/search&#x27;)\n                .query({ q: &#x27;Laptop under $400&#x27;, device: &#x27;desktop&#x27;, location: &#x27;Canada&#x27; });\n            (0, chai_1.expect)(res.status).to.equal(200);\n            (0, chai_1.expect)(res.body.success).to.be.true;\n            (0, chai_1.expect)(res.body.products).to.deep.equal(fakeProducts);\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9963f835-08b7-4f27-be9f-01343b1f0684&quot;,&quot;parentUUID&quot;:&quot;1e7c3908-249c-4093-9ede-3fb3bf8cdc14&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 if the search query is missing&quot;,&quot;fullTitle&quot;:&quot;Products API GET /api/products/search should return 400 if the search query is missing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const res = yield (0, supertest_1.default)(app).get(&#x27;/api/products/search&#x27;);\n            (0, chai_1.expect)(res.status).to.equal(400);\n            (0, chai_1.expect)(res.body.success).to.be.false;\n            (0, chai_1.expect)(res.body.error).to.equal(&#x27;Search query is required&#x27;);\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2a8da516-f962-41b8-8aff-a7113e883c37&quot;,&quot;parentUUID&quot;:&quot;1e7c3908-249c-4093-9ede-3fb3bf8cdc14&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 if the ProductService throws an error&quot;,&quot;fullTitle&quot;:&quot;Products API GET /api/products/search should return 500 if the ProductService throws an error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(ProductService_1.ProductService, &#x27;searchProducts&#x27;).throws(new Error(&#x27;SerpAPI error&#x27;));\n            const res = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/products/search&#x27;)\n                .query({ q: &#x27;Laptop&#x27; });\n            (0, chai_1.expect)(res.status).to.equal(500);\n            (0, chai_1.expect)(res.body.success).to.be.false;\n            (0, chai_1.expect)(res.body.error).to.equal(&#x27;SerpAPI error&#x27;);\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;37e1aa9a-8f40-438a-bbc0-f402b88d10bc&quot;,&quot;parentUUID&quot;:&quot;1e7c3908-249c-4093-9ede-3fb3bf8cdc14&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;9963f835-08b7-4f27-be9f-01343b1f0684&quot;,&quot;2a8da516-f962-41b8-8aff-a7113e883c37&quot;,&quot;37e1aa9a-8f40-438a-bbc0-f402b88d10bc&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:19,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;3f4ba8ab-e3f8-405d-a580-e386c1c8d1e2&quot;,&quot;title&quot;:&quot;Profile API&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\profile.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\profile.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Profile API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Profile API \&quot;before all\&quot; hook in \&quot;Profile API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;app = (0, express_1.default)();\napp.use(express_1.default.json());\napp.use(&#x27;/api/profiles&#x27;, profile_1.default);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f29c8906-d47f-4ff9-8752-f32716e93bc1&quot;,&quot;parentUUID&quot;:&quot;3f4ba8ab-e3f8-405d-a580-e386c1c8d1e2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;Profile API\&quot;&quot;,&quot;fullTitle&quot;:&quot;Profile API \&quot;after each\&quot; hook in \&quot;Profile API\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon_1.default.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c167a573-4e08-437e-82da-e9cf184abfb4&quot;,&quot;parentUUID&quot;:&quot;3f4ba8ab-e3f8-405d-a580-e386c1c8d1e2&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8fc439e1-1d6b-4ce2-b0a7-554f541b085b&quot;,&quot;title&quot;:&quot;/api/profiles/verify/:token GET&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\profile.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\profile.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing token&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 400 for missing token&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify&#x27;)\n                .query({})\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;token missing from params&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6cd1767c-0189-4911-985c-97f17ad4bc9a&quot;,&quot;parentUUID&quot;:&quot;8fc439e1-1d6b-4ce2-b0a7-554f541b085b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failing to get user&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 500 for failing to get user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByToken&#x27;).throws(new Error(\&quot;Some error related to getting user\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify/test123&#x27;)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to get user&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;eaa3e07e-7f7f-470e-911e-8bbd89e3d45d&quot;,&quot;parentUUID&quot;:&quot;8fc439e1-1d6b-4ce2-b0a7-554f541b085b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 404 for not finding valid user&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 404 for not finding valid user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByToken&#x27;).resolves(null);\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify/test123&#x27;)\n                .expect(404);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid or expired verification token&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9578454b-bd46-4d5b-9395-a0f7bcac0df4&quot;,&quot;parentUUID&quot;:&quot;8fc439e1-1d6b-4ce2-b0a7-554f541b085b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failing to verify email&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 500 for failing to verify email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeDate = (new Date()).toISOString();\n            const fakeUser = {\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                isEmailVerified: true,\n                verificationToken: &#x27;test123&#x27;,\n                verificationTokenExpires: fakeDate,\n                createdAt: fakeDate,\n                updatedAt: fakeDate,\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByToken&#x27;).resolves(fakeUser);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;verifyEmail&#x27;).throws(new Error(\&quot;Some error related to verifying email\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify/test123&#x27;)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to verify email&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1c942c07-b9bb-49e6-9bc1-c5924d2124a8&quot;,&quot;parentUUID&quot;:&quot;8fc439e1-1d6b-4ce2-b0a7-554f541b085b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for successfully verifying email&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/verify/:token GET should return 200 for successfully verifying email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeDate = (new Date()).toISOString();\n            const fakeUser = {\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                isEmailVerified: true,\n                verificationToken: &#x27;test123&#x27;,\n                verificationTokenExpires: fakeDate,\n                createdAt: fakeDate,\n                updatedAt: fakeDate,\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByToken&#x27;).resolves(fakeUser);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;verifyEmail&#x27;).resolves();\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/verify/test123&#x27;)\n                .expect(200);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Email verified successfully&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;abdd9ef0-e29e-4809-90a9-93fcb4160c5e&quot;,&quot;parentUUID&quot;:&quot;8fc439e1-1d6b-4ce2-b0a7-554f541b085b&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6cd1767c-0189-4911-985c-97f17ad4bc9a&quot;,&quot;eaa3e07e-7f7f-470e-911e-8bbd89e3d45d&quot;,&quot;9578454b-bd46-4d5b-9395-a0f7bcac0df4&quot;,&quot;1c942c07-b9bb-49e6-9bc1-c5924d2124a8&quot;,&quot;abdd9ef0-e29e-4809-90a9-93fcb4160c5e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:33,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;8b16c35c-96d7-4680-a1af-c61ed4225a23&quot;,&quot;title&quot;:&quot;/api/profiles/resend-verification POST&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\profile.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\profile.test.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 400 for missing email&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/resend-verification POST should return 400 for missing email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/profiles/resend-verification&#x27;)\n                .send({})\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;email is required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;79a8e6ac-9d96-4eca-802e-3487e043ccee&quot;,&quot;parentUUID&quot;:&quot;8b16c35c-96d7-4680-a1af-c61ed4225a23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string email&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/resend-verification POST should return 400 for non string email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/profiles/resend-verification&#x27;)\n                .send({ email: 123 })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;email must be a string&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3b74c913-6a0b-44f8-b59e-e99380d930b7&quot;,&quot;parentUUID&quot;:&quot;8b16c35c-96d7-4680-a1af-c61ed4225a23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unknown error while getting user&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/resend-verification POST should return 500 for unknown error while getting user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).throws(new Error(\&quot;Some error related to getting user\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/profiles/resend-verification&#x27;)\n                .send({ email: &#x27;test@example.com&#x27; })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to get user while verifying email&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c92c8ce9-b74f-45b7-931a-32e77e68062e&quot;,&quot;parentUUID&quot;:&quot;8b16c35c-96d7-4680-a1af-c61ed4225a23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 404 for unknown user&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/resend-verification POST should return 404 for unknown user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(null);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/profiles/resend-verification&#x27;)\n                .send({ email: &#x27;test@example.com&#x27; })\n                .expect(404);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;user cannot be found&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f8cffba8-bc35-4a00-8b5f-048af400e14e&quot;,&quot;parentUUID&quot;:&quot;8b16c35c-96d7-4680-a1af-c61ed4225a23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for user with verified email&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/resend-verification POST should return 400 for user with verified email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeUserWithoutPassword = {\n                _id: &#x27;existing_id&#x27;,\n                name: &#x27;Existing User&#x27;,\n                email: &#x27;existing@example.com&#x27;,\n                password: &#x27;hashed_password&#x27;,\n                isEmailVerified: true\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(fakeUserWithoutPassword);\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/profiles/resend-verification&#x27;)\n                .send({ email: &#x27;test@example.com&#x27; })\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;email is already verified&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cc174847-6264-43e0-87b2-e4ec32adc071&quot;,&quot;parentUUID&quot;:&quot;8b16c35c-96d7-4680-a1af-c61ed4225a23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unknown error during resending verification email&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/resend-verification POST should return 500 for unknown error during resending verification email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeUserWithoutPassword = {\n                _id: &#x27;existing_id&#x27;,\n                name: &#x27;Existing User&#x27;,\n                email: &#x27;existing@example.com&#x27;,\n                password: &#x27;hashed_password&#x27;,\n                isEmailVerified: false\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(fakeUserWithoutPassword);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;resendVerificationEmail&#x27;).throws(new Error(\&quot;Some error related to resending verification email\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/profiles/resend-verification&#x27;)\n                .send({ email: &#x27;test@example.com&#x27; })\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to resend verification email&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ebe6d50c-be37-4810-a899-fb64dfde8383&quot;,&quot;parentUUID&quot;:&quot;8b16c35c-96d7-4680-a1af-c61ed4225a23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for successfully resending email&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/resend-verification POST should return 200 for successfully resending email&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeUserWithoutPassword = {\n                _id: &#x27;existing_id&#x27;,\n                name: &#x27;Existing User&#x27;,\n                email: &#x27;existing@example.com&#x27;,\n                password: &#x27;hashed_password&#x27;,\n                isEmailVerified: false\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserByEmail&#x27;).resolves(fakeUserWithoutPassword);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;resendVerificationEmail&#x27;).resolves();\n            const response = yield (0, supertest_1.default)(app)\n                .post(&#x27;/api/profiles/resend-verification&#x27;)\n                .send({ email: &#x27;test@example.com&#x27; })\n                .expect(200);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Verification email sent&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;97ab385b-e927-47c6-9f0f-0792491fab5b&quot;,&quot;parentUUID&quot;:&quot;8b16c35c-96d7-4680-a1af-c61ed4225a23&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;79a8e6ac-9d96-4eca-802e-3487e043ccee&quot;,&quot;3b74c913-6a0b-44f8-b59e-e99380d930b7&quot;,&quot;c92c8ce9-b74f-45b7-931a-32e77e68062e&quot;,&quot;f8cffba8-bc35-4a00-8b5f-048af400e14e&quot;,&quot;cc174847-6264-43e0-87b2-e4ec32adc071&quot;,&quot;ebe6d50c-be37-4810-a899-fb64dfde8383&quot;,&quot;97ab385b-e927-47c6-9f0f-0792491fab5b&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:42,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;88c36c50-ab71-4b7c-b54d-ef09fecf1ee8&quot;,&quot;title&quot;:&quot;/api/profiles/:userId GET&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\profile.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\profile.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;/api/profiles/:userId GET\&quot;&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId GET \&quot;before each\&quot; hook in \&quot;/api/profiles/:userId GET\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;originalSecret = process.env.JWT_SECRET;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;749034b6-73fc-40a7-a1b6-691bd4410eef&quot;,&quot;parentUUID&quot;:&quot;88c36c50-ab71-4b7c-b54d-ef09fecf1ee8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;/api/profiles/:userId GET\&quot;&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId GET \&quot;after each\&quot; hook in \&quot;/api/profiles/:userId GET\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;process.env.JWT_SECRET = originalSecret; // restore&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4f16a051-492e-4f48-8a08-3ced519aa5b7&quot;,&quot;parentUUID&quot;:&quot;88c36c50-ab71-4b7c-b54d-ef09fecf1ee8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 401 for no auth token on header&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId GET should return 401 for no auth token on header&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/&#x27;)\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;No auth token in header&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;46781c5d-c163-4f80-b123-e7fb2d458978&quot;,&quot;parentUUID&quot;:&quot;88c36c50-ab71-4b7c-b54d-ef09fecf1ee8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unconfigured JWT&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId GET should return 500 for unconfigured JWT&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            delete process.env.JWT_SECRET;\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/userId123&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer sometoken`)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;JWT not configured&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ee353147-5eb2-484a-89a2-99a480b87a2d&quot;,&quot;parentUUID&quot;:&quot;88c36c50-ab71-4b7c-b54d-ef09fecf1ee8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 401 for JWT verification error&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId GET should return 401 for JWT verification error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(jsonwebtoken_1.default, &#x27;verify&#x27;).throws(new jsonwebtoken_1.JsonWebTokenError(\&quot;Some JWT verification error\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/userId123&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer sometoken`)\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid JWT&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6a7e4492-321f-405e-b628-418d895f99d2&quot;,&quot;parentUUID&quot;:&quot;88c36c50-ab71-4b7c-b54d-ef09fecf1ee8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unknown error JWT&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId GET should return 500 for unknown error JWT&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(jsonwebtoken_1.default, &#x27;verify&#x27;).throws(new Error(\&quot;Some other error during JWT verification\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/userId123&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer sometoken`)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unknown error&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9e7bd6e9-b224-4051-8c13-c83e2928cbc4&quot;,&quot;parentUUID&quot;:&quot;88c36c50-ab71-4b7c-b54d-ef09fecf1ee8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing userId on params&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId GET should return 400 for missing userId on params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(jsonwebtoken_1.default, &#x27;verify&#x27;).resolves();\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;userId missing from params&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;707e16e7-257f-4375-ad62-2fb0d50e555d&quot;,&quot;parentUUID&quot;:&quot;88c36c50-ab71-4b7c-b54d-ef09fecf1ee8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for error during getting profile&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId GET should return 500 for error during getting profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            /** Physically verify token without mocking */\n            sinon_1.default.stub(ProfileService_1.ProfileService, &#x27;getProfileByUserId&#x27;).throws(new Error(\&quot;Some error related to getting user\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/userId123&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unknown error during getting profile&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0afc8f5f-e212-4851-82cc-c522a9393921&quot;,&quot;parentUUID&quot;:&quot;88c36c50-ab71-4b7c-b54d-ef09fecf1ee8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 404 for missing profile for userId&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId GET should return 404 for missing profile for userId&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            /** Physically verify token without mocking */\n            sinon_1.default.stub(ProfileService_1.ProfileService, &#x27;getProfileByUserId&#x27;).resolves(null);\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/userId123&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(404);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to get profile with userId&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2a07db74-4d09-4565-8c52-5f5551baf070&quot;,&quot;parentUUID&quot;:&quot;88c36c50-ab71-4b7c-b54d-ef09fecf1ee8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for successfully getting profile&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId GET should return 200 for successfully getting profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            /** Physically verify token without mocking */\n            const fakeProfile = {\n                _id: &#x27;test id&#x27;,\n                userId: &#x27;test userId&#x27;,\n                storage_preference: &#x27;123GB&#x27;,\n                RAM_preference: &#x27;8GB&#x27;,\n                brand_preference: &#x27;Apple, Samsung, Sony&#x27;,\n                min_budget: 50,\n                max_budget: 500,\n                rating_preference: 5,\n                country: &#x27;Canada&#x27;,\n                address: {\n                    street: &#x27;test street&#x27;,\n                    city: &#x27;test city&#x27;,\n                    state: &#x27;test state&#x27;,\n                    zipCode: &#x27;test zip code&#x27;,\n                    country: &#x27;test country&#x27;,\n                },\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n                email: &#x27;test@example.com&#x27;,\n            };\n            sinon_1.default.stub(ProfileService_1.ProfileService, &#x27;getProfileByUserId&#x27;).resolves(fakeProfile);\n            const response = yield (0, supertest_1.default)(app)\n                .get(&#x27;/api/profiles/userId123&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(200);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Successfully retrieved profile&#x27;,\n                profile: fakeProfile\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;219d30ce-3224-49ef-8406-cc0b20030524&quot;,&quot;parentUUID&quot;:&quot;88c36c50-ab71-4b7c-b54d-ef09fecf1ee8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;46781c5d-c163-4f80-b123-e7fb2d458978&quot;,&quot;ee353147-5eb2-484a-89a2-99a480b87a2d&quot;,&quot;6a7e4492-321f-405e-b628-418d895f99d2&quot;,&quot;9e7bd6e9-b224-4051-8c13-c83e2928cbc4&quot;,&quot;707e16e7-257f-4375-ad62-2fb0d50e555d&quot;,&quot;0afc8f5f-e212-4851-82cc-c522a9393921&quot;,&quot;2a07db74-4d09-4565-8c52-5f5551baf070&quot;,&quot;219d30ce-3224-49ef-8406-cc0b20030524&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:52,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;title&quot;:&quot;/api/profiles/:userId PATCH&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\profile.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\profile.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;/api/profiles/:userId PATCH\&quot;&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId PATCH \&quot;before each\&quot; hook in \&quot;/api/profiles/:userId PATCH\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;originalSecret = process.env.JWT_SECRET;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3dad0d6d-e715-4d5a-aa83-eec82af72d9a&quot;,&quot;parentUUID&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;/api/profiles/:userId PATCH\&quot;&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId PATCH \&quot;after each\&quot; hook in \&quot;/api/profiles/:userId PATCH\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;process.env.JWT_SECRET = originalSecret; // restore&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;adfedd96-1c09-4082-aad1-5ae46446c9f6&quot;,&quot;parentUUID&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 401 for no auth token on header&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId PATCH should return 401 for no auth token on header&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/&#x27;)\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;No auth token in header&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fa8640ca-3f3e-440c-9aa1-64bd6cb7bb15&quot;,&quot;parentUUID&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unconfigured JWT&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId PATCH should return 500 for unconfigured JWT&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            delete process.env.JWT_SECRET;\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/userId123&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer sometoken`)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;JWT not configured&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d1134251-e0c3-4f21-baaf-8d865da9783b&quot;,&quot;parentUUID&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 401 for JWT verification error&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId PATCH should return 401 for JWT verification error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(jsonwebtoken_1.default, &#x27;verify&#x27;).throws(new jsonwebtoken_1.JsonWebTokenError(\&quot;Some JWT verification error\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/userId123&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer sometoken`)\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid JWT&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aa16df26-2641-4f29-932e-c1fcf1d08856&quot;,&quot;parentUUID&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unknown error JWT&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId PATCH should return 500 for unknown error JWT&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(jsonwebtoken_1.default, &#x27;verify&#x27;).throws(new Error(\&quot;Some other error during JWT verification\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/userId123&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer sometoken`)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unknown error&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;02bc4956-85e1-4bd2-a375-102910377bd3&quot;,&quot;parentUUID&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing userId on params&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId PATCH should return 400 for missing userId on params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(jsonwebtoken_1.default, &#x27;verify&#x27;).resolves();\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;userId missing from params&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6730fce6-1b8a-49d3-be18-8d3a4e7cd543&quot;,&quot;parentUUID&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing profileData in body&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId PATCH should return 400 for missing profileData in body&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(jsonwebtoken_1.default, &#x27;verify&#x27;).resolves();\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/userId123&#x27;)\n                .send({ profileData: null })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;profileData missing from body&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;583c0c97-0a45-4d88-86f3-77f6a39b8f19&quot;,&quot;parentUUID&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for error during getting profile&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId PATCH should return 500 for error during getting profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeProfileData = {\n                _id: &#x27;test id&#x27;,\n                userId: &#x27;test userId&#x27;,\n                storage_preference: &#x27;123GB&#x27;,\n                RAM_preference: &#x27;8GB&#x27;,\n                brand_preference: &#x27;Apple, Samsung, Sony&#x27;,\n                min_budget: 50,\n                max_budget: 500,\n                rating_preference: 5,\n                country: &#x27;Canada&#x27;,\n                address: {\n                    street: &#x27;test street&#x27;,\n                    city: &#x27;test city&#x27;,\n                    state: &#x27;test state&#x27;,\n                    zipCode: &#x27;test zip code&#x27;,\n                    country: &#x27;test country&#x27;,\n                },\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n                email: &#x27;test@example.com&#x27;,\n            };\n            /** Physically verify token without mocking */\n            sinon_1.default.stub(ProfileService_1.ProfileService, &#x27;getProfileByUserId&#x27;).throws(new Error(\&quot;Some error related to getting user\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/userId123&#x27;)\n                .send({ profileData: fakeProfileData })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unknown error during getting profile&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2035b3a3-265a-4818-9e95-822d815da13d&quot;,&quot;parentUUID&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 404 for missing profile for userId&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId PATCH should return 404 for missing profile for userId&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            /** Physically verify token without mocking */\n            sinon_1.default.stub(ProfileService_1.ProfileService, &#x27;getProfileByUserId&#x27;).resolves(null);\n            const fakeProfileData = {\n                _id: &#x27;test id&#x27;,\n                userId: &#x27;test userId&#x27;,\n                storage_preference: &#x27;123GB&#x27;,\n                RAM_preference: &#x27;8GB&#x27;,\n                brand_preference: &#x27;Apple, Samsung, Sony&#x27;,\n                min_budget: 50,\n                max_budget: 500,\n                rating_preference: 5,\n                country: &#x27;Canada&#x27;,\n                address: {\n                    street: &#x27;test street&#x27;,\n                    city: &#x27;test city&#x27;,\n                    state: &#x27;test state&#x27;,\n                    zipCode: &#x27;test zip code&#x27;,\n                    country: &#x27;test country&#x27;,\n                },\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n                email: &#x27;test@example.com&#x27;,\n            };\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/userId123&#x27;)\n                .send({ profileData: fakeProfileData })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(404);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;No profile found&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b02c086f-8908-4357-a12c-055e4534a10c&quot;,&quot;parentUUID&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for error with updating profile&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId PATCH should return 500 for error with updating profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeProfileData = {\n                _id: &#x27;test id&#x27;,\n                userId: &#x27;test userId&#x27;,\n                storage_preference: &#x27;1TB&#x27;,\n                RAM_preference: &#x27;32GB&#x27;,\n                brand_preference: &#x27;NVidia, Intel&#x27;,\n                min_budget: 200,\n                max_budget: 1000,\n                rating_preference: 3,\n                country: &#x27;US&#x27;,\n                address: {\n                    street: &#x27;test street&#x27;,\n                    city: &#x27;test city&#x27;,\n                    state: &#x27;test state&#x27;,\n                    zipCode: &#x27;test zip code&#x27;,\n                    country: &#x27;test country&#x27;,\n                },\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n                email: &#x27;test@example.com&#x27;,\n            };\n            const existingProfileData = {\n                _id: &#x27;test id&#x27;,\n                userId: &#x27;test userId&#x27;,\n                storage_preference: &#x27;123GB&#x27;,\n                RAM_preference: &#x27;8GB&#x27;,\n                brand_preference: &#x27;Apple, Samsung, Sony&#x27;,\n                min_budget: 50,\n                max_budget: 500,\n                rating_preference: 5,\n                country: &#x27;Canada&#x27;,\n                address: {\n                    street: &#x27;test street&#x27;,\n                    city: &#x27;test city&#x27;,\n                    state: &#x27;test state&#x27;,\n                    zipCode: &#x27;test zip code&#x27;,\n                    country: &#x27;test country&#x27;,\n                },\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n                email: &#x27;test@example.com&#x27;,\n            };\n            /** Physically verify token without mocking */\n            sinon_1.default.stub(ProfileService_1.ProfileService, &#x27;getProfileByUserId&#x27;).resolves(existingProfileData);\n            sinon_1.default.stub(ProfileService_1.ProfileService, &#x27;updateProfile&#x27;).throws(new Error(\&quot;Some error related to updating profile\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/userId123&#x27;)\n                .send({ profileData: fakeProfileData })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to update profile&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6685a3d0-7364-42ba-8d5a-c91544bffdb6&quot;,&quot;parentUUID&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for successfully updating profile&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/:userId PATCH should return 200 for successfully updating profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const fakeProfileData = {\n                _id: &#x27;test id&#x27;,\n                userId: &#x27;userId123&#x27;,\n                storage_preference: &#x27;1TB&#x27;,\n                RAM_preference: &#x27;32GB&#x27;,\n                brand_preference: &#x27;NVidia, Intel&#x27;,\n                min_budget: 200,\n                max_budget: 1000,\n                rating_preference: 3,\n                country: &#x27;US&#x27;,\n                address: {\n                    street: &#x27;test street&#x27;,\n                    city: &#x27;test city&#x27;,\n                    state: &#x27;test state&#x27;,\n                    zipCode: &#x27;test zip code&#x27;,\n                    country: &#x27;test country&#x27;,\n                },\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n                email: &#x27;test@example.com&#x27;,\n            };\n            const existingProfileData = {\n                _id: &#x27;test id&#x27;,\n                userId: &#x27;userId123&#x27;,\n                storage_preference: &#x27;123GB&#x27;,\n                RAM_preference: &#x27;8GB&#x27;,\n                brand_preference: &#x27;Apple, Samsung, Sony&#x27;,\n                min_budget: 50,\n                max_budget: 500,\n                rating_preference: 5,\n                country: &#x27;Canada&#x27;,\n                address: {\n                    street: &#x27;test street&#x27;,\n                    city: &#x27;test city&#x27;,\n                    state: &#x27;test state&#x27;,\n                    zipCode: &#x27;test zip code&#x27;,\n                    country: &#x27;test country&#x27;,\n                },\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n                email: &#x27;test@example.com&#x27;,\n            };\n            /** Physically verify token without mocking */\n            sinon_1.default.stub(ProfileService_1.ProfileService, &#x27;getProfileByUserId&#x27;).resolves(existingProfileData);\n            sinon_1.default.stub(ProfileService_1.ProfileService, &#x27;updateProfile&#x27;).resolves(fakeProfileData);\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/userId123&#x27;)\n                .send({ profileData: fakeProfileData })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(200);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Profile updated successfully&#x27;,\n                data: fakeProfileData\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;04f5f6be-d0c1-4536-aa5b-14e68eef4f9c&quot;,&quot;parentUUID&quot;:&quot;f5baa70b-f2c4-4154-bf41-4a2e97136a73&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fa8640ca-3f3e-440c-9aa1-64bd6cb7bb15&quot;,&quot;d1134251-e0c3-4f21-baaf-8d865da9783b&quot;,&quot;aa16df26-2641-4f29-932e-c1fcf1d08856&quot;,&quot;02bc4956-85e1-4bd2-a375-102910377bd3&quot;,&quot;6730fce6-1b8a-49d3-be18-8d3a4e7cd543&quot;,&quot;583c0c97-0a45-4d88-86f3-77f6a39b8f19&quot;,&quot;2035b3a3-265a-4818-9e95-822d815da13d&quot;,&quot;b02c086f-8908-4357-a12c-055e4534a10c&quot;,&quot;6685a3d0-7364-42ba-8d5a-c91544bffdb6&quot;,&quot;04f5f6be-d0c1-4536-aa5b-14e68eef4f9c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:66,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000},{&quot;uuid&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;title&quot;:&quot;/api/profiles/passwords/:userId&quot;,&quot;fullFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\src\\tests\\integration\\profile.test.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\integration\\profile.test.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;/api/profiles/passwords/:userId\&quot;&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId \&quot;before each\&quot; hook in \&quot;/api/profiles/passwords/:userId\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;originalSecret = process.env.JWT_SECRET;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4f57e9c6-3138-421f-850b-bbc9d9444a9e&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;/api/profiles/passwords/:userId\&quot;&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId \&quot;after each\&quot; hook in \&quot;/api/profiles/passwords/:userId\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;process.env.JWT_SECRET = originalSecret; // restore&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cc9c83c3-e1ab-4a6a-9850-bde764511b0a&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return 401 for no auth token on header&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 401 for no auth token on header&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords&#x27;)\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;No auth token in header&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1f591287-d498-4187-8878-79c3b67aceef&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unconfigured JWT&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 500 for unconfigured JWT&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            delete process.env.JWT_SECRET;\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords/userId123&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer sometoken`)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;JWT not configured&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9344828e-24a3-429e-9aa6-b13caf916f53&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 401 for JWT verification error&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 401 for JWT verification error&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(jsonwebtoken_1.default, &#x27;verify&#x27;).throws(new jsonwebtoken_1.JsonWebTokenError(\&quot;Some JWT verification error\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords/userId123&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer sometoken`)\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Invalid JWT&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;be800b5c-d468-48b9-bad4-ba597984c4f6&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unknown error JWT&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 500 for unknown error JWT&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:12,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(jsonwebtoken_1.default, &#x27;verify&#x27;).throws(new Error(\&quot;Some other error during JWT verification\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords/userId123&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer sometoken`)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unknown error&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0cf600e2-0b5e-440f-8304-bee763f42d59&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for userId missing from params&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 400 for userId missing from params&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:11,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords&#x27;)\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;userId missing from params&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0cb3a22e-aa4c-4b70-9059-65791212fec9&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing newPassword&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 400 for missing newPassword&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords/test123&#x27;)\n                .send({\n                currentPassword: &#x27;currentPassword&#x27;\n            })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;currentPassword and newPassword required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d1d1edef-49a3-465f-aa62-05d9c81bd515&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for missing currentPassword&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 400 for missing currentPassword&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords/test123&#x27;)\n                .send({\n                newPassword: &#x27;newPassword&#x27;\n            })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;currentPassword and newPassword required&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;67d0912e-2096-4590-b8e4-4bdd5c14bc22&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string currentPassword&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 400 for non string currentPassword&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords/test123&#x27;)\n                .send({\n                currentPassword: 123,\n                newPassword: &#x27;newPassword&#x27;\n            })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;currentPassword and newPassword need to be strings&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bb2e0d85-3d62-4b2d-8283-16275344156f&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 400 for non string currentPassword&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 400 for non string currentPassword&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords/test123&#x27;)\n                .send({\n                currentPassword: &#x27;test current&#x27;,\n                newPassword: 123\n            })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(400);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;currentPassword and newPassword need to be strings&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e88deaf3-087b-4c16-b69d-00a309f7613c&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for unknown error during getting user&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 500 for unknown error during getting user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserById&#x27;).throws(new Error(&#x27;Some error during fetching user&#x27;));\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords/userId123&#x27;)\n                .send({\n                currentPassword: &#x27;test current&#x27;,\n                newPassword: &#x27;test new&#x27;\n            })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unknown error during getting user&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f2464802-a868-4976-900c-a11dc7a2b724&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 404 for unknown user&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 404 for unknown user&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserById&#x27;).resolves(null);\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords/userId123&#x27;)\n                .send({\n                currentPassword: &#x27;test current&#x27;,\n                newPassword: &#x27;test new&#x27;\n            })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(404);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;No user found&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5456650a-e099-4f07-8a75-52d9a662eb56&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 401 for invalid currentPassword&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 401 for invalid currentPassword&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const userWithPassword = {\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test1234&#x27;,\n                isEmailVerified: true,\n                verificationToken: &#x27;test token&#x27;,\n                verificationTokenExpires: (new Date()).toISOString(),\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserById&#x27;).resolves(userWithPassword);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;comparePassword&#x27;).resolves(false);\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords/userId123&#x27;)\n                .send({\n                currentPassword: &#x27;test4321&#x27;,\n                newPassword: &#x27;test new&#x27;\n            })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(401);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Password incorrect&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;479c7808-2ffa-4eab-a5f7-adffe3bb7c44&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 500 for failed password update&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 500 for failed password update&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const userWithPassword = {\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test1234&#x27;,\n                isEmailVerified: true,\n                verificationToken: &#x27;test token&#x27;,\n                verificationTokenExpires: (new Date()).toISOString(),\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserById&#x27;).resolves(userWithPassword);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;comparePassword&#x27;).resolves(true);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;updatePassword&#x27;).throws(new Error(\&quot;Some error related to updating password\&quot;));\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords/userId123&#x27;)\n                .send({\n                currentPassword: &#x27;test1234&#x27;,\n                newPassword: &#x27;test new&#x27;\n            })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(500);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: false,\n                error: &#x27;Unable to update password&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4c719ce6-848d-4321-a4ba-e030b5ef42b1&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return 200 for successful password update&quot;,&quot;fullTitle&quot;:&quot;Profile API /api/profiles/passwords/:userId should return 200 for successful password update&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n            const userWithPassword = {\n                name: &#x27;test name&#x27;,\n                email: &#x27;test@example.com&#x27;,\n                password: &#x27;test1234&#x27;,\n                isEmailVerified: true,\n                verificationToken: &#x27;test token&#x27;,\n                verificationTokenExpires: (new Date()).toISOString(),\n                createdAt: (new Date()).toISOString(),\n                updatedAt: (new Date()).toISOString(),\n            };\n            sinon_1.default.stub(UserService_1.UserService, &#x27;getUserById&#x27;).resolves(userWithPassword);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;comparePassword&#x27;).resolves(true);\n            sinon_1.default.stub(UserService_1.UserService, &#x27;updatePassword&#x27;).resolves();\n            const response = yield (0, supertest_1.default)(app)\n                .patch(&#x27;/api/profiles/passwords/userId123&#x27;)\n                .send({\n                currentPassword: &#x27;test1234&#x27;,\n                newPassword: &#x27;test new&#x27;\n            })\n                .set(&#x27;Authorization&#x27;, `Bearer ${validToken}`)\n                .expect(200);\n            (0, chai_1.expect)(response.body).to.deep.equal({\n                success: true,\n                message: &#x27;Password updated successfully&#x27;\n            });\n        })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1ec903e5-32da-44ed-aad8-9cd368da768c&quot;,&quot;parentUUID&quot;:&quot;2bba68f6-c480-4667-8633-f5c6072d615e&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1f591287-d498-4187-8878-79c3b67aceef&quot;,&quot;9344828e-24a3-429e-9aa6-b13caf916f53&quot;,&quot;be800b5c-d468-48b9-bad4-ba597984c4f6&quot;,&quot;0cf600e2-0b5e-440f-8304-bee763f42d59&quot;,&quot;0cb3a22e-aa4c-4b70-9059-65791212fec9&quot;,&quot;d1d1edef-49a3-465f-aa62-05d9c81bd515&quot;,&quot;67d0912e-2096-4590-b8e4-4bdd5c14bc22&quot;,&quot;bb2e0d85-3d62-4b2d-8283-16275344156f&quot;,&quot;e88deaf3-087b-4c16-b69d-00a309f7613c&quot;,&quot;f2464802-a868-4976-900c-a11dc7a2b724&quot;,&quot;5456650a-e099-4f07-8a75-52d9a662eb56&quot;,&quot;479c7808-2ffa-4eab-a5f7-adffe3bb7c44&quot;,&quot;4c719ce6-848d-4321-a4ba-e030b5ef42b1&quot;,&quot;1ec903e5-32da-44ed-aad8-9cd368da768c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:118,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:20000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:20000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;11.7.0&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;integration-tests&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;mochawesome-integration&quot;,&quot;reportFilename&quot;:&quot;integration-tests&quot;},&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;integration-tests&quot;,&quot;reportDir&quot;:&quot;mochawesome-integration&quot;,&quot;reportTitle&quot;:&quot;server&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-integration\\assets&quot;,&quot;jsonFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\mochawesome-integration\\integration-tests.json&quot;,&quot;htmlFile&quot;:&quot;D:\\Uni\\C455\\Project\\team10\\server\\mochawesome-integration\\integration-tests.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>